## 14.5.2   零钱兑换问题[¶](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#1452 "Permanent link")

背包问题是一大类动态规划问题的代表，其拥有很多变种，例如零钱兑换问题。

Question

给定 n 种硬币，第 i 种硬币的面值为 coins[i−1] ，目标金额为 amt ，**每种硬币可以重复选取**，问能够凑出目标金额的最少硬币数量。如果无法凑出目标金额，则返回 −1 。示例如图 14-24 所示。

[![零钱兑换问题的示例数据](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem.assets/coin_change_example.png)](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem.assets/coin_change_example.png)

图 14-24   零钱兑换问题的示例数据

### 1.   动态规划思路[¶](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#1_1 "Permanent link")

**零钱兑换可以看作完全背包问题的一种特殊情况**，两者具有以下联系与不同点。

- 两道题可以相互转换，“物品”对应“硬币”、“物品重量”对应“硬币面值”、“背包容量”对应“目标金额”。
- 优化目标相反，完全背包问题是要最大化物品价值，零钱兑换问题是要最小化硬币数量。
- 完全背包问题是求“不超过”背包容量下的解，零钱兑换是求“恰好”凑到目标金额的解。

**第一步：思考每轮的决策，定义状态，从而得到 dp 表**

状态 [i,a] 对应的子问题为：**前 i 种硬币能够凑出金额 a 的最少硬币数量**，记为 dp[i,a] 。

二维 dp 表的尺寸为 (n+1)×(amt+1) 。

**第二步：找出最优子结构，进而推导出状态转移方程**

本题与完全背包问题的状态转移方程存在以下两点差异。

- 本题要求最小值，因此需将运算符 max() 更改为 min() 。
- 优化主体是硬币数量而非商品价值，因此在选中硬币时执行 +1 即可。

dp[i,a]=min(dp[i−1,a],dp[i,a−coins[i−1]]+1)

**第三步：确定边界条件和状态转移顺序**

当目标金额为 0 时，凑出它的最少硬币数量为 0 ，即首列所有 dp[i,0] 都等于 0 。

当无硬币时，**无法凑出任意 >0 的目标金额**，即是无效解。为使状态转移方程中的 min() 函数能够识别并过滤无效解，我们考虑使用 +∞ 来表示它们，即令首行所有 dp[0,a] 都等于 +∞ 。

### 2.   代码实现[¶](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#2_1 "Permanent link")

大多数编程语言并未提供 +∞ 变量，只能使用整型 `int` 的最大值来代替。而这又会导致大数越界：状态转移方程中的 +1 操作可能发生溢出。

为此，我们采用数字 amt+1 来表示无效解，因为凑出 amt 的硬币数量最多为 amt 。最后返回前，判断 dp[n,amt] 是否等于 amt+1 ，若是则返回 −1 ，代表无法凑出目标金额。代码如下所示：

[Python](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_1)[C++](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_2)[Java](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_3)[C#](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_4)[Go](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_5)[Swift](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_6)[JS](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_7)[TS](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_8)[Dart](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_9)[Rust](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_10)[C](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_11)[Kotlin](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_12)[Ruby](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_13)[Zig](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_4_14)

coin_change.java

`[](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-1)/* 零钱兑换：动态规划 */ [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-2)int coinChangeDP(int[] coins, int amt) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-3)    int n = coins.length; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-4)    int MAX = amt + 1; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-5)    // 初始化 dp 表 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-6)    int[][] dp = new int[n + 1][amt + 1]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-7)    // 状态转移：首行首列 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-8)    for (int a = 1; a <= amt; a++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-9)        dp[0][a] = MAX; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-10)    } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-11)    // 状态转移：其余行和列 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-12)    for (int i = 1; i <= n; i++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-13)        for (int a = 1; a <= amt; a++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-14)            if (coins[i - 1] > a) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-15)                // 若超过目标金额，则不选硬币 i [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-16)                dp[i][a] = dp[i - 1][a]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-17)            } else { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-18)                // 不选和选硬币 i 这两种方案的较小值 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-19)                dp[i][a] = Math.min(dp[i - 1][a], dp[i][a - coins[i - 1]] + 1); [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-20)            } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-21)        } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-22)    } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-23)    return dp[n][amt] != MAX ? dp[n][amt] : -1; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-30-24)}`

可视化运行

[](https://pythontutor.com/iframe-embed.html#code=def%20coin_change_dp%28coins%3A%20list%5Bint%5D,%20amt%3A%20int%29%20-%3E%20int%3A%0A%20%20%20%20%22%22%22%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2%EF%BC%9A%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%22%22%22%0A%20%20%20%20n%20%3D%20len%28coins%29%0A%20%20%20%20MAX%20%3D%20amt%20%2B%201%0A%20%20%20%20%23%20%E5%88%9D%E5%A7%8B%E5%8C%96%20dp%20%E8%A1%A8%0A%20%20%20%20dp%20%3D%20%5B%5B0%5D%20*%20%28amt%20%2B%201%29%20for%20_%20in%20range%28n%20%2B%201%29%5D%0A%20%20%20%20%23%20%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%EF%BC%9A%E9%A6%96%E8%A1%8C%E9%A6%96%E5%88%97%0A%20%20%20%20for%20a%20in%20range%281,%20amt%20%2B%201%29%3A%0A%20%20%20%20%20%20%20%20dp%5B0%5D%5Ba%5D%20%3D%20MAX%0A%20%20%20%20%23%20%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%EF%BC%9A%E5%85%B6%E4%BD%99%E8%A1%8C%E5%92%8C%E5%88%97%0A%20%20%20%20for%20i%20in%20range%281,%20n%20%2B%201%29%3A%0A%20%20%20%20%20%20%20%20for%20a%20in%20range%281,%20amt%20%2B%201%29%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20coins%5Bi%20-%201%5D%20%3E%20a%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E8%8B%A5%E8%B6%85%E8%BF%87%E7%9B%AE%E6%A0%87%E9%87%91%E9%A2%9D%EF%BC%8C%E5%88%99%E4%B8%8D%E9%80%89%E7%A1%AC%E5%B8%81%20i%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dp%5Bi%5D%5Ba%5D%20%3D%20dp%5Bi%20-%201%5D%5Ba%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E4%B8%8D%E9%80%89%E5%92%8C%E9%80%89%E7%A1%AC%E5%B8%81%20i%20%E8%BF%99%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88%E7%9A%84%E8%BE%83%E5%B0%8F%E5%80%BC%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dp%5Bi%5D%5Ba%5D%20%3D%20min%28dp%5Bi%20-%201%5D%5Ba%5D,%20dp%5Bi%5D%5Ba%20-%20coins%5Bi%20-%201%5D%5D%20%2B%201%29%0A%20%20%20%20return%20dp%5Bn%5D%5Bamt%5D%20if%20dp%5Bn%5D%5Bamt%5D%20!%3D%20MAX%20else%20-1%0A%0A%0A%22%22%22Driver%20Code%22%22%22%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20coins%20%3D%20%5B1,%202,%205%5D%0A%20%20%20%20amt%20%3D%204%0A%0A%20%20%20%20%23%20%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%0A%20%20%20%20res%20%3D%20coin_change_dp%28coins,%20amt%29%0A%20%20%20%20print%28f%22%E5%87%91%E5%88%B0%E7%9B%AE%E6%A0%87%E9%87%91%E9%A2%9D%E6%89%80%E9%9C%80%E7%9A%84%E6%9C%80%E5%B0%91%E7%A1%AC%E5%B8%81%E6%95%B0%E9%87%8F%E4%B8%BA%20%7Bres%7D%22%29&codeDivHeight=800&codeDivWidth=600&cumulative=false&curInstr=5&heapPrimitives=nevernest&origin=opt-frontend.js&py=311&rawInputLstJSON=%5B%5D&textReferences=false)

图 14-25 展示了零钱兑换的动态规划过程，和完全背包问题非常相似。

[<1>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_1)[<2>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_2)[<3>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_3)[<4>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_4)[<5>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_5)[<6>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_6)[<7>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_7)[<8>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_8)[<9>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_9)[<10>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_10)[<11>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_11)[<12>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_12)[<13>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_13)[<14>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_14)[<15>](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_5_15)

[![coin_change_dp_step6](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem.assets/coin_change_dp_step6.png)](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem.assets/coin_change_dp_step6.png)

图 14-25   零钱兑换问题的动态规划过程

### 3.   空间优化[¶](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#3_1 "Permanent link")

零钱兑换的空间优化的处理方式和完全背包问题一致：

[Python](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_1)[C++](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_2)[Java](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_3)[C#](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_4)[Go](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_5)[Swift](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_6)[JS](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_7)[TS](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_8)[Dart](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_9)[Rust](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_10)[C](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_11)[Kotlin](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_12)[Ruby](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_13)[Zig](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_6_14)

coin_change.java

`[](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-1)/* 零钱兑换：空间优化后的动态规划 */ [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-2)int coinChangeDPComp(int[] coins, int amt) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-3)    int n = coins.length; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-4)    int MAX = amt + 1; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-5)    // 初始化 dp 表 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-6)    int[] dp = new int[amt + 1]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-7)    Arrays.fill(dp, MAX); [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-8)    dp[0] = 0; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-9)    // 状态转移 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-10)    for (int i = 1; i <= n; i++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-11)        for (int a = 1; a <= amt; a++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-12)            if (coins[i - 1] > a) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-13)                // 若超过目标金额，则不选硬币 i [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-14)                dp[a] = dp[a]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-15)            } else { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-16)                // 不选和选硬币 i 这两种方案的较小值 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-17)                dp[a] = Math.min(dp[a], dp[a - coins[i - 1]] + 1); [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-18)            } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-19)        } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-20)    } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-21)    return dp[amt] != MAX ? dp[amt] : -1; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-44-22)}`

可视化运行

[](https://pythontutor.com/iframe-embed.html#code=def%20coin_change_dp_comp%28coins%3A%20list%5Bint%5D,%20amt%3A%20int%29%20-%3E%20int%3A%0A%20%20%20%20%22%22%22%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2%EF%BC%9A%E7%A9%BA%E9%97%B4%E4%BC%98%E5%8C%96%E5%90%8E%E7%9A%84%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%22%22%22%0A%20%20%20%20n%20%3D%20len%28coins%29%0A%20%20%20%20MAX%20%3D%20amt%20%2B%201%0A%20%20%20%20%23%20%E5%88%9D%E5%A7%8B%E5%8C%96%20dp%20%E8%A1%A8%0A%20%20%20%20dp%20%3D%20%5BMAX%5D%20*%20%28amt%20%2B%201%29%0A%20%20%20%20dp%5B0%5D%20%3D%200%0A%20%20%20%20%23%20%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%0A%20%20%20%20for%20i%20in%20range%281,%20n%20%2B%201%29%3A%0A%20%20%20%20%20%20%20%20%23%20%E6%AD%A3%E5%BA%8F%E9%81%8D%E5%8E%86%0A%20%20%20%20%20%20%20%20for%20a%20in%20range%281,%20amt%20%2B%201%29%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20coins%5Bi%20-%201%5D%20%3E%20a%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E8%8B%A5%E8%B6%85%E8%BF%87%E7%9B%AE%E6%A0%87%E9%87%91%E9%A2%9D%EF%BC%8C%E5%88%99%E4%B8%8D%E9%80%89%E7%A1%AC%E5%B8%81%20i%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dp%5Ba%5D%20%3D%20dp%5Ba%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E4%B8%8D%E9%80%89%E5%92%8C%E9%80%89%E7%A1%AC%E5%B8%81%20i%20%E8%BF%99%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88%E7%9A%84%E8%BE%83%E5%B0%8F%E5%80%BC%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dp%5Ba%5D%20%3D%20min%28dp%5Ba%5D,%20dp%5Ba%20-%20coins%5Bi%20-%201%5D%5D%20%2B%201%29%0A%20%20%20%20return%20dp%5Bamt%5D%20if%20dp%5Bamt%5D%20!%3D%20MAX%20else%20-1%0A%0A%0A%22%22%22Driver%20Code%22%22%22%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20coins%20%3D%20%5B1,%202,%205%5D%0A%20%20%20%20amt%20%3D%204%0A%0A%20%20%20%20%23%20%E7%A9%BA%E9%97%B4%E4%BC%98%E5%8C%96%E5%90%8E%E7%9A%84%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%0A%20%20%20%20res%20%3D%20coin_change_dp_comp%28coins,%20amt%29%0A%20%20%20%20print%28f%22%E5%87%91%E5%88%B0%E7%9B%AE%E6%A0%87%E9%87%91%E9%A2%9D%E6%89%80%E9%9C%80%E7%9A%84%E6%9C%80%E5%B0%91%E7%A1%AC%E5%B8%81%E6%95%B0%E9%87%8F%E4%B8%BA%20%7Bres%7D%22%29&codeDivHeight=800&codeDivWidth=600&cumulative=false&curInstr=5&heapPrimitives=nevernest&origin=opt-frontend.js&py=311&rawInputLstJSON=%5B%5D&textReferences=false)

## 14.5.3   零钱兑换问题 II[¶](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#1453-ii "Permanent link")

Question

给定 n 种硬币，第 i 种硬币的面值为 coins[i−1] ，目标金额为 amt ，每种硬币可以重复选取，**问凑出目标金额的硬币组合数量**。示例如图 14-26 所示。

[![零钱兑换问题 II 的示例数据](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem.assets/coin_change_ii_example.png)](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem.assets/coin_change_ii_example.png)

图 14-26   零钱兑换问题 II 的示例数据

### 1.   动态规划思路[¶](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#1_2 "Permanent link")

相比于上一题，本题目标是求组合数量，因此子问题变为：**前 i 种硬币能够凑出金额 a 的组合数量**。而 dp 表仍然是尺寸为 (n+1)×(amt+1) 的二维矩阵。

当前状态的组合数量等于不选当前硬币与选当前硬币这两种决策的组合数量之和。状态转移方程为：

dp[i,a]=dp[i−1,a]+dp[i,a−coins[i−1]]

当目标金额为 0 时，无须选择任何硬币即可凑出目标金额，因此应将首列所有 dp[i,0] 都初始化为 1 。当无硬币时，无法凑出任何 >0 的目标金额，因此首行所有 dp[0,a] 都等于 0 。

### 2.   代码实现[¶](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#2_2 "Permanent link")

[Python](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_1)[C++](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_2)[Java](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_3)[C#](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_4)[Go](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_5)[Swift](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_6)[JS](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_7)[TS](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_8)[Dart](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_9)[Rust](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_10)[C](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_11)[Kotlin](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_12)[Ruby](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_13)[Zig](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_7_14)

coin_change_ii.java

`[](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-1)/* 零钱兑换 II：动态规划 */ [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-2)int coinChangeIIDP(int[] coins, int amt) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-3)    int n = coins.length; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-4)    // 初始化 dp 表 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-5)    int[][] dp = new int[n + 1][amt + 1]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-6)    // 初始化首列 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-7)    for (int i = 0; i <= n; i++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-8)        dp[i][0] = 1; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-9)    } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-10)    // 状态转移 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-11)    for (int i = 1; i <= n; i++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-12)        for (int a = 1; a <= amt; a++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-13)            if (coins[i - 1] > a) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-14)                // 若超过目标金额，则不选硬币 i [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-15)                dp[i][a] = dp[i - 1][a]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-16)            } else { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-17)                // 不选和选硬币 i 这两种方案之和 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-18)                dp[i][a] = dp[i - 1][a] + dp[i][a - coins[i - 1]]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-19)            } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-20)        } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-21)    } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-22)    return dp[n][amt]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-58-23)}`

可视化运行

[](https://pythontutor.com/iframe-embed.html#code=def%20coin_change_ii_dp%28coins%3A%20list%5Bint%5D,%20amt%3A%20int%29%20-%3E%20int%3A%0A%20%20%20%20%22%22%22%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2%20II%EF%BC%9A%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%22%22%22%0A%20%20%20%20n%20%3D%20len%28coins%29%0A%20%20%20%20%23%20%E5%88%9D%E5%A7%8B%E5%8C%96%20dp%20%E8%A1%A8%0A%20%20%20%20dp%20%3D%20%5B%5B0%5D%20*%20%28amt%20%2B%201%29%20for%20_%20in%20range%28n%20%2B%201%29%5D%0A%20%20%20%20%23%20%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A6%96%E5%88%97%0A%20%20%20%20for%20i%20in%20range%28n%20%2B%201%29%3A%0A%20%20%20%20%20%20%20%20dp%5Bi%5D%5B0%5D%20%3D%201%0A%20%20%20%20%23%20%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%0A%20%20%20%20for%20i%20in%20range%281,%20n%20%2B%201%29%3A%0A%20%20%20%20%20%20%20%20for%20a%20in%20range%281,%20amt%20%2B%201%29%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20coins%5Bi%20-%201%5D%20%3E%20a%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E8%8B%A5%E8%B6%85%E8%BF%87%E7%9B%AE%E6%A0%87%E9%87%91%E9%A2%9D%EF%BC%8C%E5%88%99%E4%B8%8D%E9%80%89%E7%A1%AC%E5%B8%81%20i%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dp%5Bi%5D%5Ba%5D%20%3D%20dp%5Bi%20-%201%5D%5Ba%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E4%B8%8D%E9%80%89%E5%92%8C%E9%80%89%E7%A1%AC%E5%B8%81%20i%20%E8%BF%99%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88%E4%B9%8B%E5%92%8C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dp%5Bi%5D%5Ba%5D%20%3D%20dp%5Bi%20-%201%5D%5Ba%5D%20%2B%20dp%5Bi%5D%5Ba%20-%20coins%5Bi%20-%201%5D%5D%0A%20%20%20%20return%20dp%5Bn%5D%5Bamt%5D%0A%0A%0A%22%22%22Driver%20Code%22%22%22%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20coins%20%3D%20%5B1,%202,%205%5D%0A%20%20%20%20amt%20%3D%205%0A%0A%20%20%20%20%23%20%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%0A%20%20%20%20res%20%3D%20coin_change_ii_dp%28coins,%20amt%29%0A%20%20%20%20print%28f%22%E5%87%91%E5%87%BA%E7%9B%AE%E6%A0%87%E9%87%91%E9%A2%9D%E7%9A%84%E7%A1%AC%E5%B8%81%E7%BB%84%E5%90%88%E6%95%B0%E9%87%8F%E4%B8%BA%20%7Bres%7D%22%29&codeDivHeight=800&codeDivWidth=600&cumulative=false&curInstr=5&heapPrimitives=nevernest&origin=opt-frontend.js&py=311&rawInputLstJSON=%5B%5D&textReferences=false)

### 3.   空间优化[¶](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#3_2 "Permanent link")

空间优化处理方式相同，删除硬币维度即可：

[Python](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_1)[C++](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_2)[Java](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_3)[C#](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_4)[Go](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_5)[Swift](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_6)[JS](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_7)[TS](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_8)[Dart](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_9)[Rust](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_10)[C](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_11)[Kotlin](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_12)[Ruby](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_13)[Zig](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__tabbed_8_14)

coin_change_ii.java

`[](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-1)/* 零钱兑换 II：空间优化后的动态规划 */ [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-2)int coinChangeIIDPComp(int[] coins, int amt) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-3)    int n = coins.length; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-4)    // 初始化 dp 表 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-5)    int[] dp = new int[amt + 1]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-6)    dp[0] = 1; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-7)    // 状态转移 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-8)    for (int i = 1; i <= n; i++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-9)        for (int a = 1; a <= amt; a++) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-10)            if (coins[i - 1] > a) { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-11)                // 若超过目标金额，则不选硬币 i [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-12)                dp[a] = dp[a]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-13)            } else { [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-14)                // 不选和选硬币 i 这两种方案之和 [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-15)                dp[a] = dp[a] + dp[a - coins[i - 1]]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-16)            } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-17)        } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-18)    } [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-19)    return dp[amt]; [](https://www.hello-algo.com/chapter_dynamic_programming/unbounded_knapsack_problem/#__codelineno-72-20)}`