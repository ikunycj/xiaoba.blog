# å‰ç«¯å¹¶å‘é™åˆ¶æ–¹æ¡ˆ

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œ**é™åˆ¶å¹¶å‘è¯·æ±‚** æ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œç‰¹åˆ«æ˜¯åœ¨ **API è¯·æ±‚ã€æ–‡ä»¶ä¸Šä¼ ã€çˆ¬è™«çˆ¬å–æ•°æ®** ç­‰åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å‡ ç§**é€šç”¨**çš„å‰ç«¯å¹¶å‘æ§åˆ¶æ–¹æ³•ï¼Œå¯ç”¨äº **Reactã€Vueã€Node.jsã€æµè§ˆå™¨ç¯å¢ƒ** ç­‰ã€‚

---

## 1ï¸. `Promise.all` + æ‰¹é‡æ‰§è¡Œï¼ˆç®€å•åˆ†æ‰¹ï¼‰
å¦‚æœä½ æƒ³ **æ‰¹é‡æ‰§è¡Œå¤šä¸ªè¯·æ±‚**ï¼Œä½†ä¸€æ¬¡æ€§ä¸è¦è¶…å‡º `n` ä¸ªå¹¶å‘ï¼Œä½ å¯ä»¥**æ‰‹åŠ¨åˆ†æ‰¹æ‰§è¡Œ**ï¼š
```js
async function fetchWithLimit(urls, limit) {
  let results = [];
  let index = 0;

  async function fetchBatch() {
    const batch = urls.slice(index, index + limit).map(url=>
	    fetch(url).then(res => res.json()));
    index += limit;

    const batchResults = await Promise.all(batch);
    results = results.concat(batchResults);

    if (index < urls.length) {
      await fetchBatch();
    }
  }

  await fetchBatch();
  return results;
}

const urls = ["/api/data1", "/api/data2", "/api/data3", "/api/data4", "/api/data5"];
fetchWithLimit(urls, 2).then(data => console.log("æ‰€æœ‰æ•°æ®:", data));
```

- **å°æ‰¹é‡å¹¶å‘è¯·æ±‚**ï¼ˆå¦‚ 10~50 ä¸ªè¯·æ±‚ï¼‰
- **ä¸éœ€è¦åŠ¨æ€ç®¡ç†ï¼Œåªéœ€è¦é™åˆ¶æ‰¹é‡è¯·æ±‚**

---

## 2. `Promise.race` + ä»»åŠ¡é˜Ÿåˆ—ï¼ˆåŠ¨æ€æ§åˆ¶å¹¶å‘ï¼‰

å¦‚æœä½ å¸Œæœ› **é™åˆ¶å¹¶å‘**ï¼Œä½†å¯ä»¥åŠ¨æ€ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå³ï¼šå‰ä¸€ä¸ªä»»åŠ¡å®Œæˆåå†åŠ å…¥æ–°çš„è¯·æ±‚ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `Promise.race`ã€‚

```js
async function fetchWithConcurrencyLimit(urls, limit) {
  let results = [];
  let executing = [];

  async function enqueue(url) {
    const promise = fetch(url).then(res => res.json());
    results.push(promise);

    // ä»»åŠ¡å®Œæˆåä»åˆ—è¡¨ä¸­ç§»é™¤
    const e = promise.then(() => executing.splice(executing.indexOf(e), 1));
    executing.push(e);

    if (executing.length >= limit) {
      await Promise.race(executing);
    }
  }

  for (const url of urls) {
    await enqueue(url);
  }

  return Promise.all(results);
}

const urls = ["/api/data1", "/api/data2", "/api/data3", "/api/data4", "/api/data5"];
fetchWithConcurrencyLimit(urls, 2).then(data => console.log("æ‰€æœ‰æ•°æ®:", data));
```

**ğŸ“Œ é€‚ç”¨åœºæ™¯**
- **å¤§æ‰¹é‡å¹¶å‘è¯·æ±‚ï¼ˆå¦‚ 100+ï¼‰**
- **ä¿è¯å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆåï¼Œè‡ªåŠ¨åŠ å…¥æ–°ä»»åŠ¡**
- **åŠ¨æ€æ§åˆ¶å¹¶å‘é‡**

---

## 3.  `p-limit`ï¼ˆNPM ä¾èµ–ï¼Œæ›´ä¼˜é›…çš„å¹¶å‘ç®¡ç†ï¼‰

å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨ **Node.js / Webpack / React / Vue**ï¼Œå¯ä»¥ä½¿ç”¨ **`p-limit`** è¿™ä¸ªåº“ï¼Œå®ƒå¯ä»¥ **è‡ªåŠ¨ç®¡ç†å¹¶å‘ä»»åŠ¡**ã€‚

### **ğŸ“Œ å®‰è£… `p-limit`**
```bash
npm install p-limit
```

### **ğŸ“Œ ä½¿ç”¨ `p-limit` é™åˆ¶å¹¶å‘**
```javascript
import pLimit from "p-limit";

const limit = pLimit(2); // é™åˆ¶ 2 ä¸ªå¹¶å‘è¯·æ±‚

const urls = ["/api/data1", "/api/data2", "/api/data3", "/api/data4", "/api/data5"];
const tasks = urls.map(url => limit(() => fetch(url).then(res => res.json())));

Promise.all(tasks).then(data => console.log("æ‰€æœ‰æ•°æ®:", data));
```

**ğŸ“Œ é€‚ç”¨åœºæ™¯**

- **Node.js / React / Vue é¡¹ç›®**
- **ä¼˜é›…çš„å¹¶å‘æ§åˆ¶**
- **é€‚ç”¨äºæ–‡ä»¶ä¸Šä¼ ã€çˆ¬è™«ã€ä»»åŠ¡é˜Ÿåˆ—**

---

## 4.  `async/await` + `setTimeout`ï¼ˆé€æ­¥å‘èµ·è¯·æ±‚ï¼‰

å¦‚æœä½ éœ€è¦ **é€æ­¥å‘èµ·è¯·æ±‚**ï¼ˆè€Œä¸æ˜¯å…¨éƒ¨å¹¶å‘ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `setTimeout` æ§åˆ¶è¯·æ±‚é—´éš”ã€‚

**ğŸ“Œ ç¤ºä¾‹ï¼šæ¯ 1 ç§’å‘èµ· 2 ä¸ªè¯·æ±‚**
```javascript
async function fetchInBatches(urls, batchSize, delay) {
  let results = [];

  for (let i = 0; i < urls.length; i += batchSize) {
    const batch = urls.slice(i, i + batchSize);
    const batchResults = await Promise.all(batch.map(url =>
	    fetch(url).then(res => res.json())));
    results = results.concat(batchResults);

    if (i + batchSize < urls.length) {
      await new Promise(resolve => setTimeout(resolve, delay)); // æ§åˆ¶è¯·æ±‚èŠ‚å¥
    }
  }

  return results;
}

const urls = ["/api/data1", "/api/data2", "/api/data3", "/api/data4", "/api/data5"];
fetchInBatches(urls, 2, 1000).then(data => console.log("æ‰€æœ‰æ•°æ®:", data));
```

**ğŸ“Œ é€‚ç”¨åœºæ™¯**
- **å‰ç«¯é¦–å±åŠ è½½ä¼˜åŒ–**
- **é€æ­¥åŠ è½½æ•°æ®ï¼Œé¿å…ä¸€æ¬¡æ€§è¯·æ±‚è¿‡å¤š**
- **é˜²æ­¢æœåŠ¡å™¨é«˜å³°æœŸå‹åŠ›è¿‡å¤§**

---

## 5.  ä½¿ç”¨ `AbortController` å–æ¶ˆå¹¶å‘è¯·æ±‚

å¦‚æœä½ å¸Œæœ›å¯ä»¥ **åœ¨æŸä¸ªæ—¶åˆ»å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚**ï¼ˆå¦‚ï¼šç”¨æˆ·ç¦»å¼€é¡µé¢ã€ç»„ä»¶å¸è½½ï¼‰ï¼Œå¯ä»¥ç»“åˆ **`AbortController`**ã€‚

**ğŸ“Œ ç¤ºä¾‹ï¼šå–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚**
```js
let controller = new AbortController();

async function fetchData(url) {
  try {
    const response = await fetch(url, { signal: controller.signal });
    return await response.json();
  } catch (error) {
    if (error.name === "AbortError") {
      console.log("è¯·æ±‚è¢«å–æ¶ˆ:", url);
    } else {
      console.error("è¯·æ±‚å¤±è´¥:", error);
    }
  }
}

const urls = ["/api/data1", "/api/data2", "/api/data3"];
const requests = urls.map(url => fetchData(url));

// 3 ç§’åå–æ¶ˆæ‰€æœ‰è¯·æ±‚
setTimeout(() => {
  controller.abort();
  console.log("æ‰€æœ‰è¯·æ±‚å·²å–æ¶ˆ");
}, 3000);
```

**ğŸ“Œ é€‚ç”¨åœºæ™¯**

- **å‰ç«¯ç»„ä»¶å¸è½½æ—¶ï¼Œé¿å…è¯·æ±‚ç»§ç»­æ‰§è¡Œ**
- **ç”¨æˆ·ç¦»å¼€é¡µé¢æ—¶ï¼Œå–æ¶ˆæœªå®Œæˆçš„ API è°ƒç”¨**
- **åŠ¨æ€ç»ˆæ­¢ä¸å¿…è¦çš„å¹¶å‘ä»»åŠ¡**

---

## 6.  æ€»ç»“

|æ–¹æ³•|é€‚ç”¨åœºæ™¯|å…³é”®ç‚¹|
|---|---|---|
|**æ‰¹é‡è¯·æ±‚ï¼ˆ`Promise.all`ï¼‰**|å°æ‰¹é‡å¹¶å‘ï¼ˆ10~50 ä¸ªè¯·æ±‚ï¼‰|æ‰‹åŠ¨åˆ†æ‰¹|
|**ä»»åŠ¡é˜Ÿåˆ—ï¼ˆ`Promise.race`ï¼‰**|åŠ¨æ€æ§åˆ¶å¹¶å‘ä»»åŠ¡ï¼ˆ100+ è¯·æ±‚ï¼‰|ä»»åŠ¡å®ŒæˆååŠ å…¥æ–°ä»»åŠ¡|
|**`p-limit`ï¼ˆNPM åº“ï¼‰**|Node.js / React / Vue é¡¹ç›®|è‡ªåŠ¨ç®¡ç†å¹¶å‘|
|**é€æ­¥å‘èµ·ï¼ˆ`setTimeout`ï¼‰**|é€æ­¥åŠ è½½ï¼Œé¿å…æœåŠ¡å™¨å‹åŠ›|é™åˆ¶è¯·æ±‚é€Ÿç‡|
|**`AbortController`**|å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚|ç»ˆæ­¢æ— ç”¨ API è°ƒç”¨|

---

### **âœ… æ¨èä½¿ç”¨**

- **ç®€å•è¯·æ±‚** â†’ `Promise.all()`
- **å¤§é‡è¯·æ±‚** â†’ `Promise.race()`
- **æ›´ä¼˜é›…çš„æ§åˆ¶** â†’ `p-limit`
- **é€æ­¥è¯·æ±‚ï¼Œå‡å°‘å‹åŠ›** â†’ `setTimeout`
- **å¯ä»¥å–æ¶ˆè¯·æ±‚** â†’ `AbortController`

å¦‚æœä½ è¦åš **é€šç”¨çš„å‰ç«¯å¹¶å‘é™åˆ¶**ï¼Œ`p-limit` å’Œ `Promise.race` æ–¹å¼ä¼šæ›´çµæ´»ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µï¼ğŸš€







