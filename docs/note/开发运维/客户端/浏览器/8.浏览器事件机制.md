## å…«ã€æµè§ˆå™¨äº‹ä»¶æœºåˆ¶

## 1. äº‹ä»¶æ˜¯ä»€ä¹ˆï¼Ÿäº‹ä»¶æ¨¡å‹ï¼Ÿ
JavaScript çš„äº‹ä»¶æ¨¡å‹å†³å®šäº†**å¦‚ä½•ç›‘å¬ã€è§¦å‘å’Œå¤„ç†äº‹ä»¶**ï¼Œå½±å“äº‹ä»¶çš„ä¼ æ’­æ–¹å¼å’Œä½œç”¨èŒƒå›´ã€‚ç°ä»£æµè§ˆå™¨ä¸»è¦æ”¯æŒ **DOM0ã€IEã€DOM2 åŠ DOM3 äº‹ä»¶æ¨¡å‹**ã€‚

---

### 1. äº‹ä»¶çš„åŸºæœ¬æ¦‚å¿µ

åœ¨ç½‘é¡µä¸­ï¼Œäº‹ä»¶å¯ä»¥åˆ†ä¸ºï¼š

- **ç”¨æˆ·è§¦å‘äº‹ä»¶**ï¼šç‚¹å‡»ï¼ˆ`click`ï¼‰ã€é¼ æ ‡ç§»åŠ¨ï¼ˆ`mousemove`ï¼‰ã€é”®ç›˜æŒ‰ä¸‹ï¼ˆ`keydown`ï¼‰
- **æµè§ˆå™¨è§¦å‘äº‹ä»¶**ï¼šé¡µé¢åŠ è½½ï¼ˆ`load`ï¼‰ã€çª—å£æ»šåŠ¨ï¼ˆ`scroll`ï¼‰ã€å…ƒç´ å˜åŒ–ï¼ˆ`change`ï¼‰
- **å…¶ä»–äº‹ä»¶**ï¼šè‡ªå®šä¹‰äº‹ä»¶ï¼ˆ`CustomEvent`ï¼‰

æ¯ä¸ªäº‹ä»¶ä¼šåˆ›å»ºä¸€ä¸ª **`event`** å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ï¼š

- **äº‹ä»¶ç±»å‹**ï¼ˆ`type`ï¼‰ï¼šäº‹ä»¶åç§°ï¼ˆå¦‚ `click`ï¼‰
- **ç›®æ ‡å¯¹è±¡**ï¼ˆ`target`ï¼‰ï¼šè§¦å‘äº‹ä»¶çš„å…ƒç´ 
- **é¼ æ ‡/é”®ç›˜ä¿¡æ¯**ï¼ˆ`clientX`ã€`keyCode`ï¼‰
- **äº‹ä»¶çš„æ–¹æ³•**ï¼š
    - `preventDefault()`ï¼šé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆå¦‚ `form` æäº¤ï¼‰
    - `stopPropagation()`ï¼šé˜»æ­¢äº‹ä»¶å†’æ³¡

---

### 2. JavaScript äº‹ä»¶æ¨¡å‹

JavaScript çš„äº‹ä»¶æ¨¡å‹éšç€æµè§ˆå™¨å‘å±•ä¸æ–­æ¼”å˜ï¼Œç›®å‰æœ‰ 3 ç§ä¸»è¦çš„äº‹ä»¶æ¨¡å‹ã€‚

#### 2.1 DOM0 çº§äº‹ä»¶æ¨¡å‹

**ç‰¹ç‚¹**
- ç›´æ¥åœ¨ HTML æ ‡ç­¾ä¸­å®šä¹‰ï¼Œæˆ–è€…åœ¨ JavaScript ä¸­é€šè¿‡ `element.onclick` ç»‘å®šã€‚
- äº‹ä»¶**ä¸ä¼šä¼ æ’­**ï¼Œæ²¡æœ‰**äº‹ä»¶æ•è·å’Œå†’æ³¡**çš„æ¦‚å¿µã€‚
- **åªèƒ½ç»‘å®šä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°**ï¼Œåç»‘å®šçš„ä¼šè¦†ç›–ä¹‹å‰çš„ã€‚

**ç¤ºä¾‹**
**æ–¹å¼ 1ï¼šHTML ç›´æ¥ç»‘å®š**
```html
<button onclick="alert('ç‚¹å‡»æŒ‰é’®')">ç‚¹æˆ‘</button>
```

**æ–¹å¼ 2ï¼šJavaScript ç»‘å®š**
```js
let btn = document.getElementById('btn');
btn.onclick = function () {
  alert('DOM0 æ–¹å¼');
};
```

âŒ **ç¼ºç‚¹**ï¼š
- **ä¸èƒ½ç»‘å®šå¤šä¸ªäº‹ä»¶å¤„ç†å‡½æ•°**ï¼Œåè€…ä¼šè¦†ç›–å‰è€…ã€‚
- **ä¸æ”¯æŒäº‹ä»¶æ•è·å’Œå†’æ³¡**ã€‚

---

#### 2.2 IE äº‹ä»¶æ¨¡å‹

**ç‰¹ç‚¹**
- äº‹ä»¶æœ‰**ä¸¤ä¸ªé˜¶æ®µ**ï¼š**äº‹ä»¶å¤„ç†** â†’ **äº‹ä»¶å†’æ³¡**ï¼ˆæ²¡æœ‰æ•è·ï¼‰ã€‚
- äº‹ä»¶é€šè¿‡ `attachEvent()` ç»‘å®šï¼Œå¯ä»¥ç»‘å®šå¤šä¸ªäº‹ä»¶ã€‚
- **äº‹ä»¶å†’æ³¡**ï¼šäº‹ä»¶ä»ç›®æ ‡å…ƒç´ ä¼ æ’­åˆ° `document`ï¼Œç»è¿‡çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šè§¦å‘äº‹ä»¶ã€‚
- **`this` æŒ‡å‘ `window`**ï¼Œä¸åŒäº DOM2ã€‚

**ç¤ºä¾‹**
```js
let btn = document.getElementById('btn');
btn.attachEvent('onclick', function () {
  alert('IE äº‹ä»¶æ¨¡å‹');
});
```

âŒ **ç¼ºç‚¹**ï¼š

- ç°ä»£æµè§ˆå™¨å·²ç»**ä¸æ”¯æŒ** `attachEvent()`ï¼ˆIE9+ æ¨èä½¿ç”¨ `addEventListener()`ï¼‰ã€‚
- `this` å…³é”®å­—ä¼šæŒ‡å‘ `window`ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½œç”¨åŸŸé—®é¢˜ã€‚

---

#### 2.3 DOM2 çº§äº‹ä»¶æ¨¡å‹

#### **ç‰¹ç‚¹**

- äº‹ä»¶æœ‰ **ä¸‰ä¸ªé˜¶æ®µ**ï¼š
    1. **äº‹ä»¶æ•è·**ï¼ˆä» `document` å‘ä¸‹ä¼ é€’ï¼‰
    2. **ç›®æ ‡é˜¶æ®µ**ï¼ˆäº‹ä»¶è§¦å‘ï¼‰
    3. **äº‹ä»¶å†’æ³¡**ï¼ˆä»ç›®æ ‡å…ƒç´ å‘ä¸Šä¼ é€’ï¼‰
- é€šè¿‡ `addEventListener(event, handler, useCapture)` ç»‘å®šï¼š
    - `useCapture = true`ï¼šæ•è·é˜¶æ®µè§¦å‘
    - `useCapture = false`ï¼ˆé»˜è®¤ï¼‰ï¼šå†’æ³¡é˜¶æ®µè§¦å‘
- **å¯ä»¥ç»‘å®šå¤šä¸ªäº‹ä»¶å¤„ç†å‡½æ•°**ï¼Œä¸ä¼šç›¸äº’è¦†ç›–ã€‚

##### **ç¤ºä¾‹**

```js
let btn = document.getElementById('btn');

function handleClick() {
  alert('DOM2 æ–¹å¼');
}

// ç»‘å®šäº‹ä»¶ï¼ˆå†’æ³¡ï¼‰
btn.addEventListener('click', handleClick, false);
```

âœ… **ä¼˜ç‚¹**ï¼š

- **å¯ä»¥ç»‘å®šå¤šä¸ªäº‹ä»¶å¤„ç†å‡½æ•°**ï¼ˆä¸ä¼šäº’ç›¸è¦†ç›–ï¼‰ã€‚
- **æ”¯æŒäº‹ä»¶æ•è·å’Œå†’æ³¡**ï¼ˆå¯æ§åˆ¶äº‹ä»¶çš„ä¼ æ’­æ–¹å¼ï¼‰ã€‚

---

#### 2.4 DOM3 çº§äº‹ä»¶æ¨¡å‹ï¼ˆç°ä»£æµè§ˆå™¨ï¼‰

**DOM3 äº‹ä»¶æ¨¡å‹** æ˜¯ DOM2 äº‹ä»¶æ¨¡å‹çš„å‡çº§ç‰ˆï¼Œå¢åŠ äº†ï¼š

1. **æ›´å¤šçš„äº‹ä»¶ç±»å‹**ï¼šå¦‚ `input` äº‹ä»¶ï¼ˆæ–‡æœ¬æ¡†è¾“å…¥ï¼‰ã€`focusin` äº‹ä»¶ï¼ˆå†’æ³¡çš„ `focus`ï¼‰ã€‚
2. **æ”¯æŒäº‹ä»¶ç›‘å¬é€‰é¡¹**ï¼š
    - `capture: true`ï¼ˆæ•è·é˜¶æ®µè§¦å‘ï¼‰
    - `once: true`ï¼ˆäº‹ä»¶æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤ï¼‰
    - `passive: true`ï¼ˆç”¨äº `scroll` äº‹ä»¶ï¼Œé˜²æ­¢ `preventDefault()` é˜»å¡é¡µé¢ï¼‰

**ç¤ºä¾‹**
```js
document.addEventListener('scroll', function () {
  console.log('æ»šåŠ¨äº‹ä»¶');
}, { passive: true });
```

---

### 3. äº‹ä»¶æµï¼ˆEvent Flowï¼‰

**äº‹ä»¶æµ** æŒ‡çš„æ˜¯**äº‹ä»¶è§¦å‘åå¦‚ä½•ä¼ æ’­**ï¼Œåˆ†ä¸º **æ•è·ã€ç›®æ ‡ã€å†’æ³¡** ä¸‰ä¸ªé˜¶æ®µã€‚

**äº‹ä»¶æµè¿‡ç¨‹**
```txt
1ï¸âƒ£ æ•è·é˜¶æ®µï¼šdocument â†’ html â†’ body â†’ div â†’ button
2ï¸âƒ£ ç›®æ ‡é˜¶æ®µï¼šbutton
3ï¸âƒ£ å†’æ³¡é˜¶æ®µï¼šbutton â†’ div â†’ body â†’ html â†’ document
```

**ç¤ºä¾‹**
```html
<div id="outer">
  <button id="btn">ç‚¹æˆ‘</button>
</div>
```

```js
document.getElementById('outer').addEventListener('click', function () {
  console.log('div è¢«ç‚¹å‡»ï¼ˆå†’æ³¡é˜¶æ®µï¼‰');
}, false);

document.getElementById('btn').addEventListener('click', function () {
  console.log('button è¢«ç‚¹å‡»');
}, false);
```

**è¾“å‡ºé¡ºåº**
```
button è¢«ç‚¹å‡»
div è¢«ç‚¹å‡»ï¼ˆå†’æ³¡é˜¶æ®µï¼‰
```

âœ… **å¦‚æœ `useCapture = true`ï¼Œé¡ºåºå˜ä¸º**
```
div è¢«ç‚¹å‡»ï¼ˆæ•è·é˜¶æ®µï¼‰
button è¢«ç‚¹å‡»
```

---

### 4. äº‹ä»¶æ–¹æ³•

#### 4.1 é˜»æ­¢äº‹ä»¶å†’æ³¡

```js
event.stopPropagation();
```

```js
document.getElementById('btn').addEventListener('click', function (event) {
  event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
  console.log('button è¢«ç‚¹å‡»');
}, false);
```

#### 4.2 é˜»æ­¢é»˜è®¤è¡Œä¸º

```js
event.preventDefault();
```

```js
document.getElementById('link').addEventListener('click', function (event) {
  event.preventDefault(); // é˜»æ­¢è¶…é“¾æ¥è·³è½¬
  console.log('é“¾æ¥è¢«ç‚¹å‡»');
});
```

---

### 5. äº‹ä»¶ä»£ç†ï¼ˆEvent Delegationï¼‰

**äº‹ä»¶ä»£ç†** é€šè¿‡**äº‹ä»¶å†’æ³¡æœºåˆ¶**ï¼Œåœ¨**çˆ¶å…ƒç´ ä¸Šç›‘å¬å­å…ƒç´ çš„äº‹ä»¶**ï¼Œæé«˜æ€§èƒ½ã€‚

#### **ç¤ºä¾‹**
```html
<ul id="list">
  <li>Item 1</li>
  <li>Item 2</li>
  <li>Item 3</li>
</ul>
```

```js
document.getElementById('list').addEventListener('click', function (event) {
  if (event.target.tagName === 'LI') {
    alert('ç‚¹å‡»äº† ' + event.target.innerText);
  }
});
```

âœ… **ä¼˜ç‚¹**

- **å‡å°‘äº‹ä»¶ç»‘å®šæ•°é‡**ï¼Œæé«˜æ€§èƒ½ã€‚
- **åŠ¨æ€å…ƒç´ ä¹Ÿèƒ½è§¦å‘äº‹ä»¶**ã€‚

---

### **6. äº‹ä»¶æ¨¡å‹å¯¹æ¯”æ€»ç»“**

|äº‹ä»¶æ¨¡å‹|äº‹ä»¶æµé˜¶æ®µ|äº‹ä»¶ç»‘å®šæ–¹å¼|æ˜¯å¦æ”¯æŒå¤šä¸ªç›‘å¬å‡½æ•°|`this` æŒ‡å‘|
|---|---|---|---|---|
|**DOM0**|æ— ä¼ æ’­|`onclick = fn`|âŒï¼ˆä¼šè¦†ç›–ï¼‰|äº‹ä»¶ç›®æ ‡|
|**IE äº‹ä»¶**|äº‹ä»¶å¤„ç† + å†’æ³¡|`attachEvent`|âœ…ï¼ˆé¡ºåºæ‰§è¡Œï¼‰|`window`|
|**DOM2/3**|æ•è· + ç›®æ ‡ + å†’æ³¡|`addEventListener`|âœ…|äº‹ä»¶ç›®æ ‡|

---

#### **æ€»ç»“**

- **DOM2/3 äº‹ä»¶æ¨¡å‹**æ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„æ ‡å‡†ã€‚
- **äº‹ä»¶æµ = æ•è· â†’ ç›®æ ‡ â†’ å†’æ³¡**ã€‚
- **äº‹ä»¶ä»£ç†**æ˜¯æé«˜æ€§èƒ½çš„é‡è¦æŠ€å·§ã€‚
- **é˜»æ­¢å†’æ³¡**ï¼ˆ`stopPropagation()`ï¼‰å’Œ**é˜»æ­¢é»˜è®¤è¡Œä¸º**ï¼ˆ`preventDefault()`ï¼‰æ˜¯å¸¸ç”¨çš„äº‹ä»¶æ§åˆ¶æ–¹æ³•ã€‚

## 2. å¦‚ä½•é˜»æ­¢äº‹ä»¶å†’æ³¡

- æ™®é€šæµè§ˆå™¨ä½¿ç”¨ï¼š`event.stopPropagation()`
- IEæµè§ˆå™¨ä½¿ç”¨ï¼š`event.cancelBubble = true`;

## 3.äº‹ä»¶å§”æ‰˜ï¼ˆEvent Delegationï¼‰

### 1. ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼Ÿ

**äº‹ä»¶å§”æ‰˜**ï¼ˆEvent Delegationï¼‰æ˜¯ä¸€ç§**åŸºäºäº‹ä»¶å†’æ³¡**çš„æŠ€æœ¯ï¼Œé€šè¿‡**ç»™çˆ¶å…ƒç´ ç»‘å®šäº‹ä»¶**ï¼Œè®©å­å…ƒç´ è§¦å‘æ—¶ï¼Œäº‹ä»¶é€šè¿‡**å†’æ³¡**æœºåˆ¶ä¼ é€’åˆ°çˆ¶å…ƒç´ ï¼Œç”±çˆ¶å…ƒç´ ç»Ÿä¸€å¤„ç†ï¼Œè€Œä¸æ˜¯ç»™æ¯ä¸ªå­å…ƒç´ éƒ½ç»‘å®šäº‹ä»¶ã€‚

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼Ÿ

âœ… **ä¼˜åŠ¿**
- **å‡å°‘äº‹ä»¶ç»‘å®šï¼Œæé«˜æ€§èƒ½**ï¼šç‰¹åˆ«é€‚ç”¨äºæœ‰å¤§é‡åŠ¨æ€å­å…ƒç´ çš„æƒ…å†µã€‚
- **å¯ä»¥å¤„ç†åŠ¨æ€å…ƒç´ **ï¼šå³ä½¿æ˜¯**åæ·»åŠ çš„å…ƒç´ **ï¼Œä»ç„¶å¯ä»¥è§¦å‘äº‹ä»¶ï¼Œä¸éœ€è¦é‡æ–°ç»‘å®šã€‚
- **ä»£ç ç®€æ´**ï¼šåªåœ¨çˆ¶å…ƒç´ ä¸Šç»‘å®šä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯ä¸ªå­å…ƒç´ éƒ½ç»‘å®šã€‚

ğŸš« **å±€é™**
- **æŸäº›äº‹ä»¶ä¸ä¼šå†’æ³¡**ï¼Œå¦‚ `blur`ã€`focus` éœ€è¦ä½¿ç”¨ `focusin` å’Œ `focusout` ä»£æ›¿ã€‚
- **äº‹ä»¶ç›®æ ‡ï¼ˆevent.targetï¼‰éœ€è¦åˆ¤æ–­**ï¼Œç¡®ä¿åªå¯¹ç‰¹å®šå­å…ƒç´ ç”Ÿæ•ˆã€‚

---

### 3. äº‹ä»¶å§”æ‰˜çš„å·¥ä½œåŸç†

#### äº‹ä»¶æµï¼ˆäº‹ä»¶å†’æ³¡ï¼‰

1. **ç”¨æˆ·ç‚¹å‡»å­å…ƒç´ **
2. **äº‹ä»¶ä»å­å…ƒç´ å†’æ³¡åˆ°çˆ¶å…ƒç´ **
3. **çˆ¶å…ƒç´ çš„äº‹ä»¶ç›‘å¬å™¨è§¦å‘**
4. **ç›‘å¬å™¨æ£€æŸ¥ `event.target`ï¼Œç¡®è®¤äº‹ä»¶æ¥è‡ªå“ªä¸ªå­å…ƒç´ **
5. **æ‰§è¡Œç›¸åº”é€»è¾‘**

---

### 4. äº‹ä»¶å§”æ‰˜ç¤ºä¾‹
#### 4.1 ä¼ ç»Ÿæ–¹å¼ï¼ˆæ¯ä¸ªå­å…ƒç´ ç»‘å®šäº‹ä»¶ï¼‰

```html
<ul>
  <li id="item1">Item 1</li>
  <li id="item2">Item 2</li>
  <li id="item3">Item 3</li>
</ul>
```

```js
document.getElementById('item1').addEventListener('click', function () {
  alert('Item 1 è¢«ç‚¹å‡»');
});
document.getElementById('item2').addEventListener('click', function () {
  alert('Item 2 è¢«ç‚¹å‡»');
});
document.getElementById('item3').addEventListener('click', function () {
  alert('Item 3 è¢«ç‚¹å‡»');
});
```

âŒ **é—®é¢˜**ï¼š
- **æ¯ä¸ªå­å…ƒç´ éƒ½è¦ç»‘å®šäº‹ä»¶**ï¼Œæµªè´¹èµ„æºï¼Œä»£ç å†—ä½™ã€‚
- **å¦‚æœåŠ¨æ€æ·»åŠ æ–°å…ƒç´ ï¼Œä¸ä¼šè§¦å‘äº‹ä»¶**ã€‚

---

#### 4.2 ä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼ˆç»™çˆ¶å…ƒç´ ç»‘å®šäº‹ä»¶ï¼‰

```js
document.querySelector('ul').addEventListener('click', function (event) {
  if (event.target.tagName === 'LI') {
    alert(event.target.innerText + ' è¢«ç‚¹å‡»');
  }
});
```

âœ… **ä¼˜åŒ–ç‚¹**
- **åªç»‘å®šä¸€æ¬¡äº‹ä»¶**
- **æ”¯æŒåŠ¨æ€æ–°å¢çš„ `li`**

---

### 5. é€‚ç”¨åœºæ™¯

#### 5.1 å¤„ç†åŠ¨æ€åˆ—è¡¨

```html
<ul id="list">
  <li>Item 1</li>
  <li>Item 2</li>
</ul>
<button id="addItem">æ·»åŠ æ–°é¡¹</button>
```

```js
document.getElementById('list').addEventListener('click', function (event) {
  if (event.target.tagName === 'LI') {
    alert(event.target.innerText + ' è¢«ç‚¹å‡»');
  }
});

document.getElementById('addItem').addEventListener('click', function () {
  let newItem = document.createElement('li');
  newItem.innerText = 'æ–°é¡¹';
  document.getElementById('list').appendChild(newItem);
});
```

**æ•ˆæœ**
- ç‚¹å‡» `æ·»åŠ æ–°é¡¹` æŒ‰é’®ï¼Œæ–°å¢ `li`
- ç‚¹å‡» `li`ï¼Œä»ç„¶å¯ä»¥è§¦å‘äº‹ä»¶

---

#### 5.2 å¤„ç†è¡¨å•äº‹ä»¶

æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›**åœ¨å¤šä¸ª `input` æ¡†ä¸Šç›‘å¬è¾“å…¥äº‹ä»¶**ï¼š

```html
<form id="myForm">
  <input type="text" name="username" placeholder="ç”¨æˆ·å">
  <input type="text" name="email" placeholder="é‚®ç®±">
</form>
```

```js
document.getElementById('myForm').addEventListener('input', function (event) {
  if (event.target.tagName === 'INPUT') {
    console.log(event.target.name + ': ' + event.target.value);
  }
});
```

âœ… **å¥½å¤„**

- åªç»‘å®šä¸€æ¬¡äº‹ä»¶
- å¯ä»¥**å¤„ç†æ‰€æœ‰ `input` äº‹ä»¶**ï¼Œå³ä½¿æ˜¯åŠ¨æ€æ·»åŠ çš„ `input`

---

#### 5.3 å¤„ç†æŒ‰é’®ç‚¹å‡»

```html
<div id="container">
  <button class="btn">æŒ‰é’® 1</button>
  <button class="btn">æŒ‰é’® 2</button>
</div>
```

```js
document.getElementById('container').addEventListener('click', function (event) {
  if (event.target.classList.contains('btn')) {
    alert(event.target.innerText + ' è¢«ç‚¹å‡»');
  }
});
```

âœ… **ä½¿ç”¨ `classList.contains()` è¿‡æ»¤ç›®æ ‡**

---

### 6. äº‹ä»¶å§”æ‰˜é€‚ç”¨äºå“ªäº›äº‹ä»¶ï¼Ÿ

#### âœ… é€‚ç”¨äºå†’æ³¡äº‹ä»¶

|äº‹ä»¶|è¯´æ˜|
|---|---|
|`click`|ç”¨æˆ·ç‚¹å‡»|
|`dblclick`|åŒå‡»|
|`mousedown` / `mouseup`|é¼ æ ‡æŒ‰ä¸‹/é‡Šæ”¾|
|`mousemove`|é¼ æ ‡ç§»åŠ¨|
|`mouseover` / `mouseout`|é¼ æ ‡è¿›å…¥/ç¦»å¼€|
|`keydown` / `keyup`|é”®ç›˜æŒ‰ä¸‹/é‡Šæ”¾|
|`input`|è¾“å…¥æ¡†å˜åŒ–|
|`change`|å¤é€‰æ¡†ã€é€‰æ‹©æ¡†å˜åŒ–|

#### ğŸš« ä¸é€‚ç”¨äºä¸ä¼šå†’æ³¡çš„äº‹ä»¶

|äº‹ä»¶|æ›¿ä»£æ–¹æ¡ˆ|
|---|---|
|`blur` / `focus`|`focusin` / `focusout`|
|`mouseenter` / `mouseleave`|`mouseover` / `mouseout`|
|`scroll`|ä¸èƒ½ç”¨äº‹ä»¶å§”æ‰˜|

---

### 7. äº‹ä»¶å§”æ‰˜ vs ç›´æ¥ç»‘å®š

|**æ–¹å¼**|**äº‹ä»¶ç»‘å®šä½ç½®**|**æ˜¯å¦æ”¯æŒåŠ¨æ€å…ƒç´ **|**æ€§èƒ½**|**ä»£ç é‡**|
|---|---|---|---|---|
|**ç›´æ¥ç»‘å®š**|ç›®æ ‡å…ƒç´ |âŒ å¦|å·®ï¼ˆå¤šä¸ªäº‹ä»¶ï¼‰|ä»£ç å¤š|
|**äº‹ä»¶å§”æ‰˜**|çˆ¶çº§å…ƒç´ |âœ… æ˜¯|ä¼˜ï¼ˆä¸€ä¸ªäº‹ä»¶ï¼‰|ä»£ç å°‘|

---

### 8. äº‹ä»¶å§”æ‰˜ + `stopPropagation()`

æœ‰æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½**ä¸å¸Œæœ›äº‹ä»¶è¿›ä¸€æ­¥å†’æ³¡**ï¼Œå¯ä»¥ä½¿ç”¨ `stopPropagation()`ï¼š

```html
<div id="parent">
  <button id="child">å­æŒ‰é’®</button>
</div>
```

```js
document.getElementById('parent').addEventListener('click', function () {
  alert('çˆ¶å…ƒç´ è¢«ç‚¹å‡»');
});

document.getElementById('child').addEventListener('click', function (event) {
  event.stopPropagation(); // é˜»æ­¢å†’æ³¡
  alert('å­æŒ‰é’®è¢«ç‚¹å‡»');
});
```

âœ… **æ•ˆæœ**
- ç‚¹å‡» `å­æŒ‰é’®`ï¼š**åªå¼¹å‡º "å­æŒ‰é’®è¢«ç‚¹å‡»"**
- ç‚¹å‡» `çˆ¶å…ƒç´ `ï¼š**åªå¼¹å‡º "çˆ¶å…ƒç´ è¢«ç‚¹å‡»"**

---

### 9. æ€»ç»“
- **äº‹ä»¶å§”æ‰˜é€šè¿‡äº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œåœ¨çˆ¶å…ƒç´ ä¸Šç›‘å¬å­å…ƒç´ çš„äº‹ä»¶ï¼Œæé«˜æ€§èƒ½ã€‚**
- **é€‚ç”¨äºåŠ¨æ€å…ƒç´ ï¼Œå‡å°‘äº‹ä»¶ç»‘å®šï¼Œä»£ç æ›´ç®€æ´ã€‚**
- **é€‚ç”¨äº `click`ã€`input` ç­‰å†’æ³¡äº‹ä»¶ï¼Œä¸é€‚ç”¨äº `focus`ã€`scroll`ã€‚**
- **å¯ä»¥é…åˆ `stopPropagation()` æ§åˆ¶äº‹ä»¶ä¼ æ’­ã€‚**

ğŸ”¥ **äº‹ä»¶å§”æ‰˜æ˜¯é«˜æ€§èƒ½ JavaScript ä»£ç çš„æœ€ä½³å®è·µä¹‹ä¸€ï¼Œå‰ç«¯å¼€å‘å¿…é¡»æŒæ¡ï¼** ğŸ”¥


## 4. åŒæ­¥å’Œå¼‚æ­¥

åœ¨ JavaScript ä¸­ï¼Œ**åŒæ­¥ï¼ˆSynchronousï¼‰** å’Œ **å¼‚æ­¥ï¼ˆAsynchronousï¼‰** æ˜¯ä»£ç æ‰§è¡Œçš„ä¸¤ç§æ–¹å¼ï¼Œå½±å“ç¨‹åºçš„æ‰§è¡Œé¡ºåºå’Œæ€§èƒ½ã€‚

---

### 1. ä»€ä¹ˆæ˜¯åŒæ­¥ï¼ˆSynchronousï¼‰ï¼Ÿ

**åŒæ­¥** æŒ‡çš„æ˜¯ **ä»£ç æŒ‰é¡ºåºæ‰§è¡Œ**ï¼Œå½“å‰ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œã€‚æ‰€æœ‰ä»»åŠ¡åœ¨**ä¸»çº¿ç¨‹**ä¸Šæ’é˜Ÿæ‰§è¡Œï¼Œ**ä¸ä¼šè·³è¿‡ä»»ä½•ä»»åŠ¡**ã€‚

**ç¤ºä¾‹ï¼šåŒæ­¥ä»£ç **
```js
console.log("1");
console.log("2");
console.log("3");
```

**æ‰§è¡Œé¡ºåº**
```
1
2
3
```

âœ… **ç‰¹ç‚¹**
- **ä»£ç æŒ‰é¡ºåºæ‰§è¡Œ**ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªã€‚
- **é˜»å¡**ï¼šå¦‚æœæŸä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œæ•´ä¸ªç¨‹åºä¼šè¢«å¡ä½ï¼Œä¸èƒ½æ‰§è¡Œåç»­ä»£ç ã€‚

ğŸš« **ç¼ºç‚¹**
- **æ‰§è¡Œæ…¢**ï¼šå¦‚æœæŸä¸ªä»»åŠ¡ï¼ˆå¦‚ `while` å¾ªç¯æˆ– `I/O æ“ä½œ`ï¼‰è€—æ—¶è¿‡é•¿ï¼Œä¼šé˜»å¡åé¢çš„ä»£ç ï¼Œå¯¼è‡´é¡µé¢æ— å“åº”ï¼ˆå¡æ­»ï¼‰ã€‚

---

### 2. ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼ˆAsynchronousï¼‰ï¼Ÿ

**å¼‚æ­¥** æŒ‡çš„æ˜¯ **ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹**ï¼Œè€Œæ˜¯**è®©ä»»åŠ¡æ‰§è¡Œæ—¶å…ˆè·³è¿‡ï¼Œç»§ç»­æ‰§è¡Œåç»­ä»£ç **ï¼Œç­‰åˆ°å¼‚æ­¥ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œå›è°ƒã€‚

**ç¤ºä¾‹ï¼šå¼‚æ­¥ä»£ç **
```js
console.log("1");

setTimeout(() => {
  console.log("2");
}, 1000);

console.log("3");
```

**æ‰§è¡Œé¡ºåº**
```
1
3
2  ï¼ˆå»¶è¿Ÿ 1 ç§’åæ‰§è¡Œï¼‰
```

âœ… **ç‰¹ç‚¹**
- **ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹**ï¼Œèƒ½åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚
- **æ‰§è¡Œæ•ˆç‡é«˜**ï¼Œé€‚ç”¨äº `I/O æ“ä½œ`ã€`ç½‘ç»œè¯·æ±‚`ã€`å®šæ—¶å™¨`ã€`äº‹ä»¶ç›‘å¬` ç­‰ã€‚
- **ä»»åŠ¡å®Œæˆåï¼Œä½¿ç”¨å›è°ƒå‡½æ•°æˆ– Promise å¤„ç†ç»“æœ**ã€‚

---

### 3. åŒæ­¥ vs å¼‚æ­¥

| |**åŒæ­¥ï¼ˆSynchronousï¼‰**|**å¼‚æ­¥ï¼ˆAsynchronousï¼‰**|
|---|---|---|
|**æ‰§è¡Œé¡ºåº**|æŒ‰é¡ºåºæ‰§è¡Œï¼Œç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆ|å…ˆæ‰§è¡Œåç»­ä»£ç ï¼Œå¼‚æ­¥ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œ|
|**æ˜¯å¦é˜»å¡ä¸»çº¿ç¨‹**|æ˜¯|å¦|
|**é€‚ç”¨åœºæ™¯**|è®¡ç®—ä»»åŠ¡ã€ç®€å•é€»è¾‘|I/O æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€å®šæ—¶ä»»åŠ¡|
|**ç¼ºç‚¹**|æ‰§è¡Œæ…¢ï¼Œå¯èƒ½å¡ä½|éœ€è¦å›è°ƒã€Promiseã€async/await|

---

### 4. JavaScript ä¸­çš„å¼‚æ­¥å®ç°æ–¹å¼

#### 4.1 å›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰

**å›è°ƒå‡½æ•°** æ˜¯æœ€åŸºç¡€çš„å¼‚æ­¥å¤„ç†æ–¹å¼ï¼Œå¸¸ç”¨äº **äº‹ä»¶ç›‘å¬ã€å®šæ—¶å™¨ã€æ–‡ä»¶è¯»å–ã€ç½‘ç»œè¯·æ±‚**ã€‚

**ç¤ºä¾‹ï¼šå›è°ƒå‡½æ•°**
```js
function fetchData(callback) {
  setTimeout(() => {
    callback("æ•°æ®åŠ è½½å®Œæˆ");
  }, 1000);
}

fetchData((data) => {
  console.log(data);
});
console.log("ç¨‹åºç»§ç»­æ‰§è¡Œ");
```

**æ‰§è¡Œé¡ºåº**
```
ç¨‹åºç»§ç»­æ‰§è¡Œ
æ•°æ®åŠ è½½å®Œæˆï¼ˆ1 ç§’åï¼‰
```

ğŸš« **é—®é¢˜**
- **å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰**ï¼šåµŒå¥—å¤ªæ·±ï¼Œä»£ç éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚
- **å¯è¯»æ€§å·®ï¼Œå®¹æ˜“å‡ºé”™**ã€‚

**å›è°ƒåœ°ç‹±ç¤ºä¾‹**
```js
getData1(() => {
  getData2(() => {
    getData3(() => {
      console.log("æ•°æ®è·å–å®Œæˆ");
    });
  });
});
```

---

#### 4.2 Promiseï¼ˆES6ï¼‰

**Promise** æ˜¯**è§£å†³å›è°ƒåœ°ç‹±**çš„ä¸€ç§æ–¹å¼ï¼Œæä¾› `.then()` å’Œ `.catch()` æ–¹æ³•ï¼Œä½¿ä»£ç æ›´æ¸…æ™°ã€‚

**ç¤ºä¾‹ï¼šPromise**
```js
function fetchData() {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve("æ•°æ®åŠ è½½æˆåŠŸ");
    }, 1000);
  });
}

fetchData().then((data) => {
  console.log(data);
});
console.log("ç¨‹åºç»§ç»­æ‰§è¡Œ");
```

**æ‰§è¡Œé¡ºåº**
```
ç¨‹åºç»§ç»­æ‰§è¡Œ
æ•°æ®åŠ è½½æˆåŠŸï¼ˆ1 ç§’åï¼‰
```

âœ… **ä¼˜ç‚¹**
- **é¿å…å›è°ƒåœ°ç‹±**ï¼Œä»£ç æ›´æ¸…æ™°ã€‚
- **æ”¯æŒé“¾å¼è°ƒç”¨**ã€‚

ğŸš« **ç¼ºç‚¹**
- ä»ç„¶éœ€è¦ `.then()`ï¼Œé€»è¾‘è¾ƒå¤æ‚ã€‚

---

#### 4.3 async/awaitï¼ˆES7ï¼‰

**async/await** æ˜¯ **Promise çš„è¯­æ³•ç³–**ï¼Œå¯ä»¥è®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼Œæé«˜å¯è¯»æ€§ã€‚

**ç¤ºä¾‹ï¼šasync/await**
```js
function fetchData() {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve("æ•°æ®åŠ è½½æˆåŠŸ");
    }, 1000);
  });
}

async function loadData() {
  console.log("å¼€å§‹è¯·æ±‚æ•°æ®");
  let data = await fetchData();
  console.log(data);
}

loadData();
console.log("ç¨‹åºç»§ç»­æ‰§è¡Œ");
```

**æ‰§è¡Œé¡ºåº**
```
å¼€å§‹è¯·æ±‚æ•°æ®
ç¨‹åºç»§ç»­æ‰§è¡Œ
æ•°æ®åŠ è½½æˆåŠŸï¼ˆ1 ç§’åï¼‰
```

âœ… **ä¼˜ç‚¹**
- **è¯­æ³•ç®€æ´ï¼Œæ˜“è¯»æ˜“å†™**ã€‚
- **åƒåŒæ­¥ä»£ç ä¸€æ ·æ‰§è¡Œ**ï¼Œå‡å°‘å›è°ƒåµŒå¥—ã€‚

ğŸš« **ç¼ºç‚¹**
- **éœ€è¦é…åˆ Promise** ä½¿ç”¨ã€‚
- **try/catch å¤„ç†é”™è¯¯**ã€‚

---

### 5. çœŸå®åœºæ™¯ï¼šç½‘ç»œè¯·æ±‚

**åŒæ­¥è¯·æ±‚ï¼ˆé˜»å¡ï¼‰**
```js
// å‘é€ HTTP è¯·æ±‚ï¼ˆåŒæ­¥æ–¹å¼ï¼‰
let response = fetch('https://api.example.com/data');
console.log(response);
```

âš ï¸ **é—®é¢˜**ï¼šåŒæ­¥è¯·æ±‚ä¼šé˜»å¡ä»£ç ï¼Œç”¨æˆ·ä½“éªŒå·®ã€‚

---

**å¼‚æ­¥è¯·æ±‚ï¼ˆæ¨èï¼‰**

```js
// æ–¹å¼ 1ï¼šPromise
fetch("https://api.example.com/data")
  .then((response) => response.json())
  .then((data) => console.log(data))
  .catch((error) => console.error(error));

// æ–¹å¼ 2ï¼šasync/await
async function getData() {
  try {
    let response = await fetch("https://api.example.com/data");
    let data = await response.json();
    console.log(data);
  } catch (error) {
    console.error(error);
  }
}

getData();
```

âœ… **ä¼˜ç‚¹**

- **å¼‚æ­¥è¯·æ±‚ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹**ã€‚
- **æ”¯æŒ `.catch()` å¤„ç†é”™è¯¯**ã€‚

---

### 6. äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰

JavaScript æ˜¯**å•çº¿ç¨‹**çš„ï¼Œä½†å®ƒé€šè¿‡ **äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰** å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚

#### äº‹ä»¶å¾ªç¯å·¥ä½œåŸç†

1. **åŒæ­¥ä»£ç ** å…ˆæ‰§è¡Œï¼ˆä¸»çº¿ç¨‹ï¼‰ã€‚
2. **å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚ `setTimeout`ã€`Promise`ï¼‰æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—**ã€‚
3. **ä¸»çº¿ç¨‹ç©ºé—²æ—¶**ï¼Œä»ä»»åŠ¡é˜Ÿåˆ—å–å‡ºä»»åŠ¡æ‰§è¡Œã€‚
4. **ç»§ç»­å¾ªç¯ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆ**ã€‚

---

**ç¤ºä¾‹ï¼šäº‹ä»¶å¾ªç¯**
```js
console.log("1");

setTimeout(() => {
  console.log("2");
}, 0);

Promise.resolve().then(() => {
  console.log("3");
});

console.log("4");
```

**æ‰§è¡Œé¡ºåº**
```
1
4
3
2
```

âœ… **è§„åˆ™**

1. **åŒæ­¥ä»£ç ** å…ˆæ‰§è¡Œï¼ˆ1ã€4ï¼‰ã€‚
2. **Promise ä»»åŠ¡ï¼ˆå¾®ä»»åŠ¡ï¼‰** å…ˆæ‰§è¡Œï¼ˆ3ï¼‰ã€‚
3. **setTimeout ä»»åŠ¡ï¼ˆå®ä»»åŠ¡ï¼‰** åæ‰§è¡Œï¼ˆ2ï¼‰ã€‚

---

### 7. æ€»ç»“

| |**åŒæ­¥ï¼ˆSynchronousï¼‰**|**å¼‚æ­¥ï¼ˆAsynchronousï¼‰**|
|---|---|---|
|**æ‰§è¡Œé¡ºåº**|æŒ‰é¡ºåºæ‰§è¡Œ|å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå¼‚æ­¥ä»»åŠ¡ç¨åæ‰§è¡Œ|
|**æ˜¯å¦é˜»å¡**|æ˜¯|å¦|
|**å®ç°æ–¹å¼**|ç›´æ¥æ‰§è¡Œ|`setTimeout` / `Promise` / `async/await`|
|**é€‚ç”¨åœºæ™¯**|ç®€å•é€»è¾‘|I/Oã€ç½‘ç»œè¯·æ±‚ã€äº‹ä»¶ç›‘å¬|

ğŸ”¥ **ç°ä»£ JavaScript æ¨èä½¿ç”¨ `async/await` å¤„ç†å¼‚æ­¥ï¼Œæé«˜ä»£ç å¯è¯»æ€§ï¼**


## 5. äº‹ä»¶å¾ªç¯

å› ä¸º js æ˜¯å•çº¿ç¨‹è¿è¡Œçš„ï¼Œåœ¨ä»£ç æ‰§è¡Œæ—¶ï¼Œé€šè¿‡å°†ä¸åŒå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å‹å…¥æ‰§è¡Œæ ˆä¸­æ¥ä¿è¯ä»£ç çš„æœ‰åºæ‰§è¡Œã€‚åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç æ—¶ï¼Œå¦‚æœé‡åˆ°å¼‚æ­¥äº‹ä»¶ï¼Œjs å¼•æ“å¹¶ä¸ä¼šä¸€ç›´ç­‰å¾…å…¶è¿”å›ç»“æœï¼Œè€Œæ˜¯ä¼šå°†è¿™ä¸ªäº‹ä»¶æŒ‚èµ·ï¼Œç»§ç»­æ‰§è¡Œæ‰§è¡Œæ ˆä¸­çš„å…¶ä»–ä»»åŠ¡ã€‚å½“å¼‚æ­¥äº‹ä»¶æ‰§è¡Œå®Œæ¯•åï¼Œå†å°†å¼‚æ­¥äº‹ä»¶å¯¹åº”çš„å›è°ƒåŠ å…¥åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚ä»»åŠ¡é˜Ÿåˆ—å¯ä»¥åˆ†ä¸ºå®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå½“å½“å‰æ‰§è¡Œæ ˆä¸­çš„äº‹ä»¶æ‰§è¡Œå®Œæ¯•åï¼Œjs å¼•æ“é¦–å…ˆä¼šåˆ¤æ–­å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ä»»åŠ¡å¯ä»¥æ‰§è¡Œï¼Œå¦‚æœæœ‰å°±å°†å¾®ä»»åŠ¡é˜Ÿé¦–çš„äº‹ä»¶å‹å…¥æ ˆä¸­æ‰§è¡Œã€‚å½“å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆåå†å»æ‰§è¡Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/426a3bf11f404821abb636690119621b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)

Event Loop æ‰§è¡Œé¡ºåºå¦‚ä¸‹æ‰€ç¤ºï¼š

- é¦–å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè¿™å±äºå®ä»»åŠ¡
- å½“æ‰§è¡Œå®Œæ‰€æœ‰åŒæ­¥ä»£ç åï¼Œæ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¼‚æ­¥ä»£ç éœ€è¦æ‰§è¡Œ
- æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡
- å½“æ‰§è¡Œå®Œæ‰€æœ‰å¾®ä»»åŠ¡åï¼Œå¦‚æœ‰å¿…è¦ä¼šæ¸²æŸ“é¡µé¢
- ç„¶åå¼€å§‹ä¸‹ä¸€è½® Event Loopï¼Œæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç 

## 6. å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡

- å¾®ä»»åŠ¡åŒ…æ‹¬ï¼š promise çš„å›è°ƒã€node ä¸­çš„ process.nextTick ã€å¯¹ Dom å˜åŒ–ç›‘å¬çš„ MutationObserverã€‚
- å®ä»»åŠ¡åŒ…æ‹¬ï¼š script è„šæœ¬çš„æ‰§è¡Œã€setTimeout ï¼ŒsetInterval ï¼ŒsetImmediate ä¸€ç±»çš„å®šæ—¶äº‹ä»¶ï¼Œè¿˜æœ‰å¦‚ I/O æ“ä½œã€UI æ¸²æŸ“ç­‰ã€‚

## 8. æ‰§è¡Œæ ˆ

å¯ä»¥æŠŠæ‰§è¡Œæ ˆè®¤ä¸ºæ˜¯ä¸€ä¸ªå­˜å‚¨å‡½æ•°è°ƒç”¨çš„**æ ˆç»“æ„**ï¼Œéµå¾ªå…ˆè¿›åå‡ºçš„åŸåˆ™ã€‚ ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/391e7d7e880f42d59809dbc16af5d7bf~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp) å½“å¼€å§‹æ‰§è¡Œ JS ä»£ç æ—¶ï¼Œæ ¹æ®å…ˆè¿›åå‡ºçš„åŸåˆ™ï¼Œåæ‰§è¡Œçš„å‡½æ•°ä¼šå…ˆå¼¹å‡ºæ ˆï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ`foo` å‡½æ•°åæ‰§è¡Œï¼Œå½“æ‰§è¡Œå®Œæ¯•åå°±ä»æ ˆä¸­å¼¹å‡ºäº†ã€‚

å¹³æ—¶åœ¨å¼€å‘ä¸­ï¼Œå¯ä»¥åœ¨æŠ¥é”™ä¸­æ‰¾åˆ°æ‰§è¡Œæ ˆçš„ç—•è¿¹ï¼š

```js
function foo() {   
	throw new Error('error') 
} 

function bar() {   
	foo() 
} 

bar()
```

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab3646b742d946659e4bce34d5af6751~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp) å¯ä»¥çœ‹åˆ°æŠ¥é”™åœ¨ `foo` å‡½æ•°ï¼Œ`foo` å‡½æ•°åˆæ˜¯åœ¨ `bar` å‡½æ•°ä¸­è°ƒç”¨çš„ã€‚å½“ä½¿ç”¨é€’å½’æ—¶ï¼Œå› ä¸ºæ ˆå¯å­˜æ”¾çš„å‡½æ•°æ˜¯æœ‰**é™åˆ¶**çš„ï¼Œä¸€æ—¦å­˜æ”¾äº†è¿‡å¤šçš„å‡½æ•°ä¸”æ²¡æœ‰å¾—åˆ°é‡Šæ”¾çš„è¯ï¼Œå°±ä¼šå‡ºç°çˆ†æ ˆçš„é—®é¢˜

```js
function bar() {  bar()}bar()
```

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cac7e59102dc4c3a9efa53aecd64bf9d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)

## 9. Node ä¸­çš„ Event Loop å’Œæµè§ˆå™¨ä¸­çš„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿprocess.nextTick æ‰§è¡Œé¡ºåºï¼Ÿ

Node ä¸­çš„ Event Loop å’Œæµè§ˆå™¨ä¸­çš„æ˜¯å®Œå…¨ä¸ç›¸åŒçš„ä¸œè¥¿ã€‚

Node çš„ Event Loop åˆ†ä¸º 6 ä¸ªé˜¶æ®µï¼Œå®ƒä»¬ä¼šæŒ‰ç…§**é¡ºåº**åå¤è¿è¡Œã€‚æ¯å½“è¿›å…¥æŸä¸€ä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œéƒ½ä¼šä»å¯¹åº”çš„å›è°ƒé˜Ÿåˆ—ä¸­å–å‡ºå‡½æ•°å»æ‰§è¡Œã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ•°é‡åˆ°è¾¾ç³»ç»Ÿè®¾å®šçš„é˜ˆå€¼ï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚ 
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed6d249f54e242fe9dc267f03fa156d3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)

ï¼ˆ1ï¼‰**Timersï¼ˆè®¡æ—¶å™¨é˜¶æ®µï¼‰**ï¼šåˆæ¬¡è¿›å…¥äº‹ä»¶å¾ªç¯ï¼Œä¼šä»è®¡æ—¶å™¨é˜¶æ®µå¼€å§‹ã€‚æ­¤é˜¶æ®µä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿‡æœŸçš„è®¡æ—¶å™¨å›è°ƒï¼ˆåŒ…å« setTimeout å’Œ setIntervalï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¼šæ‰§è¡Œæ‰€æœ‰è¿‡æœŸçš„è®¡æ—¶å™¨å›è°ƒï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœå›è°ƒä¸­è§¦å‘äº†ç›¸åº”çš„å¾®ä»»åŠ¡ï¼Œä¼šæ¥ç€æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå¾®ä»»åŠ¡åå†è¿›å…¥ Pending callbacks é˜¶æ®µã€‚

ï¼ˆ2ï¼‰**Pending callbacks**ï¼šæ‰§è¡Œæ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå¾ªç¯è¿­ä»£çš„**I / O**å›è°ƒï¼ˆç³»ç»Ÿè°ƒç”¨ç›¸å…³çš„å›è°ƒï¼‰ã€‚

ï¼ˆ3ï¼‰**Idle/Prepare**ï¼šä»…ä¾›å†…éƒ¨ä½¿ç”¨ã€‚

ï¼ˆ4ï¼‰**Pollï¼ˆè½®è¯¢é˜¶æ®µï¼‰**ï¼š

- å½“å›è°ƒé˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼šä¼šæ‰§è¡Œå›è°ƒï¼Œè‹¥å›è°ƒä¸­è§¦å‘äº†ç›¸åº”çš„å¾®ä»»åŠ¡ï¼Œè¿™é‡Œçš„å¾®ä»»åŠ¡æ‰§è¡Œæ—¶æœºå’Œå…¶ä»–åœ°æ–¹æœ‰æ‰€ä¸åŒï¼Œä¸ä¼šç­‰åˆ°æ‰€æœ‰å›è°ƒæ‰§è¡Œå®Œæ¯•åæ‰æ‰§è¡Œï¼Œè€Œæ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªå›è°ƒæ‰§è¡Œå®Œæ¯•åï¼Œå°±æ‰§è¡Œç›¸åº”å¾®ä»»åŠ¡ã€‚æ‰§è¡Œå®Œæ‰€æœ‰çš„å›è°ƒåï¼Œå˜ä¸ºä¸‹é¢çš„æƒ…å†µã€‚
- å½“å›è°ƒé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ˆæ²¡æœ‰å›è°ƒæˆ–æ‰€æœ‰å›è°ƒæ‰§è¡Œå®Œæ¯•ï¼‰ï¼šä½†å¦‚æœå­˜åœ¨æœ‰è®¡æ—¶å™¨ï¼ˆsetTimeoutã€setIntervalå’ŒsetImmediateï¼‰æ²¡æœ‰æ‰§è¡Œï¼Œä¼šç»“æŸè½®è¯¢é˜¶æ®µï¼Œè¿›å…¥ Check é˜¶æ®µã€‚å¦åˆ™ä¼šé˜»å¡å¹¶ç­‰å¾…ä»»ä½•æ­£åœ¨æ‰§è¡Œçš„I/Oæ“ä½œå®Œæˆï¼Œå¹¶é©¬ä¸Šæ‰§è¡Œç›¸åº”çš„å›è°ƒï¼Œç›´åˆ°æ‰€æœ‰å›è°ƒæ‰§è¡Œå®Œæ¯•ã€‚

ï¼ˆ5ï¼‰**Checkï¼ˆæŸ¥è¯¢é˜¶æ®µï¼‰**ï¼šä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ setImmediate ç›¸å…³çš„å›è°ƒï¼Œå¦‚æœå­˜åœ¨åˆ™æ‰§è¡Œæ‰€æœ‰å›è°ƒï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœå›è°ƒä¸­è§¦å‘äº†ç›¸åº”çš„å¾®ä»»åŠ¡ï¼Œä¼šæ¥ç€æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå¾®ä»»åŠ¡åå†è¿›å…¥ Close callbacks é˜¶æ®µã€‚

ï¼ˆ6ï¼‰**Close callbacks**ï¼šæ‰§è¡Œä¸€äº›å…³é—­å›è°ƒï¼Œæ¯”å¦‚socket.on('close', ...)ç­‰ã€‚

ä¸‹é¢æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œé¦–å…ˆåœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œå®šæ—¶å™¨çš„æ‰§è¡Œé¡ºåºå…¶å®æ˜¯**éšæœº**çš„

```js
setTimeout(() => {    
	console.log('setTimeout')
}, 0)

setImmediate(() => {    
	console.log('setImmediate')
})
```

å¯¹äºä»¥ä¸Šä»£ç æ¥è¯´ï¼Œ`setTimeout` å¯èƒ½æ‰§è¡Œåœ¨å‰ï¼Œä¹Ÿå¯èƒ½æ‰§è¡Œåœ¨å

- é¦–å…ˆ `setTimeout(fn, 0) === setTimeout(fn, 1)`ï¼Œè¿™æ˜¯ç”±æºç å†³å®šçš„
- è¿›å…¥äº‹ä»¶å¾ªç¯ä¹Ÿæ˜¯éœ€è¦æˆæœ¬çš„ï¼Œå¦‚æœåœ¨å‡†å¤‡æ—¶å€™èŠ±è´¹äº†å¤§äº 1ms çš„æ—¶é—´ï¼Œé‚£ä¹ˆåœ¨ timer é˜¶æ®µå°±ä¼šç›´æ¥æ‰§è¡Œ `setTimeout` å›è°ƒ
- é‚£ä¹ˆå¦‚æœå‡†å¤‡æ—¶é—´èŠ±è´¹å°äº 1msï¼Œé‚£ä¹ˆå°±æ˜¯ `setImmediate` å›è°ƒå…ˆæ‰§è¡Œäº†

å½“ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºä¸€å®šæ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š

```js
const fs = require('fs') 
fs.readFile(__filename, () => {     
	setTimeout(() => {         
		console.log('timeout');     
	}, 0)     
	
	setImmediate(() => {         
		console.log('immediate')     
	}) 
})
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ`setImmediate` æ°¸è¿œ**å…ˆæ‰§è¡Œ**ã€‚å› ä¸ºä¸¤ä¸ªä»£ç å†™åœ¨ IO å›è°ƒä¸­ï¼ŒIO å›è°ƒæ˜¯åœ¨ poll é˜¶æ®µæ‰§è¡Œï¼Œå½“å›è°ƒæ‰§è¡Œå®Œæ¯•åé˜Ÿåˆ—ä¸ºç©ºï¼Œå‘ç°å­˜åœ¨ `setImmediate` å›è°ƒï¼Œæ‰€ä»¥å°±ç›´æ¥è·³è½¬åˆ° check é˜¶æ®µå»æ‰§è¡Œå›è°ƒäº†ã€‚

ä¸Šé¢éƒ½æ˜¯ macrotask çš„æ‰§è¡Œæƒ…å†µï¼Œå¯¹äº microtask æ¥è¯´ï¼Œå®ƒä¼šåœ¨ä»¥ä¸Šæ¯ä¸ªé˜¶æ®µå®Œæˆå‰**æ¸…ç©º** microtask é˜Ÿåˆ—ï¼Œä¸‹å›¾ä¸­çš„ Tick å°±ä»£è¡¨äº† microtask 

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ea27044a0124facaab3e4a8da89d709~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)

```js
setTimeout(() => {
  console.log('timer21')
}, 0)
Promise.resolve().then(function() {
  console.log('promise1')
})
```
å¯¹äºä»¥ä¸Šä»£ç æ¥è¯´ï¼Œå…¶å®å’Œæµè§ˆå™¨ä¸­çš„è¾“å‡ºæ˜¯ä¸€æ ·çš„ï¼Œmicrotask æ°¸è¿œæ‰§è¡Œåœ¨ macrotask å‰é¢ã€‚

æœ€åæ¥çœ‹ Node ä¸­çš„ `process.nextTick`ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®æ˜¯ç‹¬ç«‹äº Event Loop ä¹‹å¤–çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªè‡ªå·±çš„é˜Ÿåˆ—ï¼Œå½“æ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œå¦‚æœå­˜åœ¨ nextTick é˜Ÿåˆ—ï¼Œå°±ä¼š**æ¸…ç©ºé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å›è°ƒå‡½æ•°**ï¼Œå¹¶ä¸”ä¼˜å…ˆäºå…¶ä»– microtask æ‰§è¡Œã€‚

```js
setTimeout(() => {
 console.log('timer1')
 Promise.resolve().then(function() {
   console.log('promise1')
 })
}, 0)
process.nextTick(() => {
 console.log('nextTick')
 process.nextTick(() => {
   console.log('nextTick')
   process.nextTick(() => {
     console.log('nextTick')
     process.nextTick(() => {
       console.log('nextTick')
     })
   })
 })
})
```

å¯¹äºä»¥ä¸Šä»£ç ï¼Œæ°¸è¿œéƒ½æ˜¯å…ˆæŠŠ nextTick å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚

## 10. äº‹ä»¶è§¦å‘çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„

äº‹ä»¶è§¦å‘æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š

- `window` å¾€äº‹ä»¶è§¦å‘å¤„ä¼ æ’­ï¼Œé‡åˆ°æ³¨å†Œçš„æ•è·äº‹ä»¶ä¼šè§¦å‘
- ä¼ æ’­åˆ°äº‹ä»¶è§¦å‘å¤„æ—¶è§¦å‘æ³¨å†Œçš„äº‹ä»¶
- ä»äº‹ä»¶è§¦å‘å¤„å¾€ `window` ä¼ æ’­ï¼Œé‡åˆ°æ³¨å†Œçš„å†’æ³¡äº‹ä»¶ä¼šè§¦å‘

äº‹ä»¶è§¦å‘ä¸€èˆ¬æ¥è¯´ä¼šæŒ‰ç…§ä¸Šé¢çš„é¡ºåºè¿›è¡Œï¼Œä½†æ˜¯ä¹Ÿæœ‰ç‰¹ä¾‹ï¼Œ**å¦‚æœç»™ä¸€ä¸ª** `body` **ä¸­çš„å­èŠ‚ç‚¹åŒæ—¶æ³¨å†Œå†’æ³¡å’Œæ•è·äº‹ä»¶ï¼Œäº‹ä»¶è§¦å‘ä¼šæŒ‰ç…§æ³¨å†Œçš„é¡ºåºæ‰§è¡Œ**

```js
// ä»¥ä¸‹ä¼šå…ˆæ‰“å°å†’æ³¡ç„¶åæ˜¯æ•è·
node.addEventListener(
  'click',
  event => {
    console.log('å†’æ³¡')
  },
  false
)
node.addEventListener(
  'click',
  event => {
    console.log('æ•è· ')
  },
  true
)
```

é€šå¸¸ä½¿ç”¨ `addEventListener` æ³¨å†Œäº‹ä»¶ï¼Œè¯¥å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥æ˜¯å¸ƒå°”å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚å¯¹äºå¸ƒå°”å€¼ `useCapture` å‚æ•°æ¥è¯´ï¼Œè¯¥å‚æ•°é»˜è®¤å€¼ä¸º `false` ï¼Œ`useCapture` å†³å®šäº†æ³¨å†Œçš„äº‹ä»¶æ˜¯æ•è·äº‹ä»¶è¿˜æ˜¯å†’æ³¡äº‹ä»¶ã€‚å¯¹äºå¯¹è±¡å‚æ•°æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªå±æ€§ï¼š

- `capture`ï¼šå¸ƒå°”å€¼ï¼Œå’Œ `useCapture` ä½œç”¨ä¸€æ ·
- `once`ï¼šå¸ƒå°”å€¼ï¼Œå€¼ä¸º `true` è¡¨ç¤ºè¯¥å›è°ƒåªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œè°ƒç”¨åä¼šç§»é™¤ç›‘å¬
- `passive`ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ°¸è¿œä¸ä¼šè°ƒç”¨ `preventDefault`

ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœåªå¸Œæœ›äº‹ä»¶åªè§¦å‘åœ¨ç›®æ ‡ä¸Šï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ `stopPropagation` æ¥é˜»æ­¢äº‹ä»¶çš„è¿›ä¸€æ­¥ä¼ æ’­ã€‚é€šå¸¸è®¤ä¸º `stopPropagation` æ˜¯ç”¨æ¥é˜»æ­¢äº‹ä»¶å†’æ³¡çš„ï¼Œå…¶å®è¯¥å‡½æ•°ä¹Ÿå¯ä»¥é˜»æ­¢æ•è·äº‹ä»¶ã€‚

`stopImmediatePropagation` åŒæ ·ä¹Ÿèƒ½å®ç°é˜»æ­¢äº‹ä»¶ï¼Œä½†æ˜¯è¿˜èƒ½é˜»æ­¢è¯¥äº‹ä»¶ç›®æ ‡æ‰§è¡Œåˆ«çš„æ³¨å†Œäº‹ä»¶ã€‚
```js
node.addEventListener(
  'click',
  event => {
    event.stopImmediatePropagation()
    console.log('å†’æ³¡')
  },
  false
)
// ç‚¹å‡» node åªä¼šæ‰§è¡Œä¸Šé¢çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸ä¼šæ‰§è¡Œ
node.addEventListener(
  'click',
  event => {
    console.log('æ•è· ')
  },
  true
)
```

