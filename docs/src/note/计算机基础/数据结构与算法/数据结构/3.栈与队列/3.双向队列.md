# 5.3   双向队列[¶](https://www.hello-algo.com/chapter_stack_and_queue/deque/#53 "Permanent link")

在队列中，我们仅能删除头部元素或在尾部添加元素。如图 5-7 所示，双向队列（double-ended queue）提供了更高的灵活性，允许在头部和尾部执行元素的添加或删除操作。

[![双向队列的操作](https://www.hello-algo.com/chapter_stack_and_queue/deque.assets/deque_operations.png)](https://www.hello-algo.com/chapter_stack_and_queue/deque.assets/deque_operations.png)

图 5-7   双向队列的操作

## 5.3.1   双向队列常用操作[¶](https://www.hello-algo.com/chapter_stack_and_queue/deque/#531 "Permanent link")

双向队列的常用操作如表 5-3 所示，具体的方法名称需要根据所使用的编程语言来确定。

表 5-3   双向队列操作效率

|方法名|描述|时间复杂度|
|---|---|---|
|`push_first()`|将元素添加至队首|O(1)|
|`push_last()`|将元素添加至队尾|O(1)|
|`pop_first()`|删除队首元素|O(1)|
|`pop_last()`|删除队尾元素|O(1)|
|`peek_first()`|访问队首元素|O(1)|
|`peek_last()`|访问队尾元素|O(1)|

同样地，我们可以直接使用编程语言中已实现的双向队列类：

[Python](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_1)[C++](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_2)[Java](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_3)[C#](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_4)[Go](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_5)[Swift](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_6)[JS](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_7)[TS](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_8)[Dart](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_9)[Rust](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_10)[C](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_11)[Kotlin](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_12)[Ruby](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_13)[Zig](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_1_14)

deque.java

`[](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-1)/* 初始化双向队列 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-2)Deque<Integer> deque = new LinkedList<>(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-3) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-4)/* 元素入队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-5)deque.offerLast(2);   // 添加至队尾 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-6)deque.offerLast(5); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-7)deque.offerLast(4); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-8)deque.offerFirst(3);  // 添加至队首 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-9)deque.offerFirst(1); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-10) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-11)/* 访问元素 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-12)int peekFirst = deque.peekFirst();  // 队首元素 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-13)int peekLast = deque.peekLast();    // 队尾元素 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-14) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-15)/* 元素出队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-16)int popFirst = deque.pollFirst();  // 队首元素出队 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-17)int popLast = deque.pollLast();    // 队尾元素出队 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-18) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-19)/* 获取双向队列的长度 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-20)int size = deque.size(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-21) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-22)/* 判断双向队列是否为空 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-2-23)boolean isEmpty = deque.isEmpty();`

可视化运行

[](https://pythontutor.com/iframe-embed.html#code=from%20collections%20import%20deque%0A%0A%22%22%22Driver%20Code%22%22%22%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20%23%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%8C%E5%90%91%E9%98%9F%E5%88%97%0A%20%20%20%20deq%20%3D%20deque%28%29%0A%0A%20%20%20%20%23%20%E5%85%83%E7%B4%A0%E5%85%A5%E9%98%9F%0A%20%20%20%20deq.append%282%29%20%20%23%20%E6%B7%BB%E5%8A%A0%E8%87%B3%E9%98%9F%E5%B0%BE%0A%20%20%20%20deq.append%285%29%0A%20%20%20%20deq.append%284%29%0A%20%20%20%20deq.appendleft%283%29%20%20%23%20%E6%B7%BB%E5%8A%A0%E8%87%B3%E9%98%9F%E9%A6%96%0A%20%20%20%20deq.appendleft%281%29%0A%20%20%20%20print%28%22%E5%8F%8C%E5%90%91%E9%98%9F%E5%88%97%20deque%20%3D%22,%20deq%29%0A%0A%20%20%20%20%23%20%E8%AE%BF%E9%97%AE%E5%85%83%E7%B4%A0%0A%20%20%20%20front%20%3D%20deq%5B0%5D%20%20%23%20%E9%98%9F%E9%A6%96%E5%85%83%E7%B4%A0%0A%20%20%20%20print%28%22%E9%98%9F%E9%A6%96%E5%85%83%E7%B4%A0%20front%20%3D%22,%20front%29%0A%20%20%20%20rear%20%3D%20deq%5B-1%5D%20%20%23%20%E9%98%9F%E5%B0%BE%E5%85%83%E7%B4%A0%0A%20%20%20%20print%28%22%E9%98%9F%E5%B0%BE%E5%85%83%E7%B4%A0%20rear%20%3D%22,%20rear%29%0A%0A%20%20%20%20%23%20%E5%85%83%E7%B4%A0%E5%87%BA%E9%98%9F%0A%20%20%20%20pop_front%20%3D%20deq.popleft%28%29%20%20%23%20%E9%98%9F%E9%A6%96%E5%85%83%E7%B4%A0%E5%87%BA%E9%98%9F%0A%20%20%20%20print%28%22%E9%98%9F%E9%A6%96%E5%87%BA%E9%98%9F%E5%85%83%E7%B4%A0%20%20pop_front%20%3D%22,%20pop_front%29%0A%20%20%20%20print%28%22%E9%98%9F%E9%A6%96%E5%87%BA%E9%98%9F%E5%90%8E%20deque%20%3D%22,%20deq%29%0A%20%20%20%20pop_rear%20%3D%20deq.pop%28%29%20%20%23%20%E9%98%9F%E5%B0%BE%E5%85%83%E7%B4%A0%E5%87%BA%E9%98%9F%0A%20%20%20%20print%28%22%E9%98%9F%E5%B0%BE%E5%87%BA%E9%98%9F%E5%85%83%E7%B4%A0%20%20pop_rear%20%3D%22,%20pop_rear%29%0A%20%20%20%20print%28%22%E9%98%9F%E5%B0%BE%E5%87%BA%E9%98%9F%E5%90%8E%20deque%20%3D%22,%20deq%29%0A%0A%20%20%20%20%23%20%E8%8E%B7%E5%8F%96%E5%8F%8C%E5%90%91%E9%98%9F%E5%88%97%E7%9A%84%E9%95%BF%E5%BA%A6%0A%20%20%20%20size%20%3D%20len%28deq%29%0A%20%20%20%20print%28%22%E5%8F%8C%E5%90%91%E9%98%9F%E5%88%97%E9%95%BF%E5%BA%A6%20size%20%3D%22,%20size%29%0A%0A%20%20%20%20%23%20%E5%88%A4%E6%96%AD%E5%8F%8C%E5%90%91%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E4%B8%BA%E7%A9%BA%0A%20%20%20%20is_empty%20%3D%20len%28deq%29%20%3D%3D%200%0A%20%20%20%20print%28%22%E5%8F%8C%E5%90%91%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E4%B8%BA%E7%A9%BA%20%3D%22,%20is_empty%29&codeDivHeight=800&codeDivWidth=600&cumulative=false&curInstr=3&heapPrimitives=nevernest&origin=opt-frontend.js&py=311&rawInputLstJSON=%5B%5D&textReferences=false)

## 5.3.2   双向队列实现 *[¶](https://www.hello-algo.com/chapter_stack_and_queue/deque/#532 "Permanent link")

双向队列的实现与队列类似，可以选择链表或数组作为底层数据结构。

### 1.   基于双向链表的实现[¶](https://www.hello-algo.com/chapter_stack_and_queue/deque/#1 "Permanent link")

回顾上一节内容，我们使用普通单向链表来实现队列，因为它可以方便地删除头节点（对应出队操作）和在尾节点后添加新节点（对应入队操作）。

对于双向队列而言，头部和尾部都可以执行入队和出队操作。换句话说，双向队列需要实现另一个对称方向的操作。为此，我们采用“双向链表”作为双向队列的底层数据结构。

如图 5-8 所示，我们将双向链表的头节点和尾节点视为双向队列的队首和队尾，同时实现在两端添加和删除节点的功能。

[LinkedListDeque](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_2_1)[push_last()](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_2_2)[push_first()](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_2_3)[pop_last()](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_2_4)[pop_first()](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_2_5)

[![基于链表实现双向队列的入队出队操作](https://www.hello-algo.com/chapter_stack_and_queue/deque.assets/linkedlist_deque_step1.png)](https://www.hello-algo.com/chapter_stack_and_queue/deque.assets/linkedlist_deque_step1.png)

图 5-8   基于链表实现双向队列的入队出队操作

实现代码如下所示：

[Python](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_1)[C++](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_2)[Java](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_3)[C#](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_4)[Go](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_5)[Swift](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_6)[JS](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_7)[TS](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_8)[Dart](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_9)[Rust](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_10)[C](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_11)[Kotlin](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_12)[Ruby](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_13)[Zig](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_3_14)

linkedlist_deque.java

`[](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-1)/* 双向链表节点 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-2)class ListNode { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-3)    int val; // 节点值 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-4)    ListNode next; // 后继节点引用 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-5)    ListNode prev; // 前驱节点引用 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-6) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-7)    ListNode(int val) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-8)        this.val = val; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-9)        prev = next = null; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-10)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-11)} [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-12) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-13)/* 基于双向链表实现的双向队列 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-14)class LinkedListDeque { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-15)    private ListNode front, rear; // 头节点 front ，尾节点 rear [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-16)    private int queSize = 0; // 双向队列的长度 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-17) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-18)    public LinkedListDeque() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-19)        front = rear = null; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-20)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-21) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-22)    /* 获取双向队列的长度 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-23)    public int size() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-24)        return queSize; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-25)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-26) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-27)    /* 判断双向队列是否为空 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-28)    public boolean isEmpty() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-29)        return size() == 0; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-30)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-31) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-32)    /* 入队操作 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-33)    private void push(int num, boolean isFront) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-34)        ListNode node = new ListNode(num); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-35)        // 若链表为空，则令 front 和 rear 都指向 node [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-36)        if (isEmpty()) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-37)            front = rear = node; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-38)        // 队首入队操作 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-39)        else if (isFront) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-40)            // 将 node 添加至链表头部 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-41)            front.prev = node; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-42)            node.next = front; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-43)            front = node; // 更新头节点 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-44)        // 队尾入队操作 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-45)        } else { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-46)            // 将 node 添加至链表尾部 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-47)            rear.next = node; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-48)            node.prev = rear; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-49)            rear = node; // 更新尾节点 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-50)        } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-51)        queSize++; // 更新队列长度 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-52)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-53) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-54)    /* 队首入队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-55)    public void pushFirst(int num) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-56)        push(num, true); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-57)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-58) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-59)    /* 队尾入队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-60)    public void pushLast(int num) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-61)        push(num, false); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-62)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-63) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-64)    /* 出队操作 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-65)    private int pop(boolean isFront) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-66)        if (isEmpty()) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-67)            throw new IndexOutOfBoundsException(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-68)        int val; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-69)        // 队首出队操作 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-70)        if (isFront) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-71)            val = front.val; // 暂存头节点值 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-72)            // 删除头节点 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-73)            ListNode fNext = front.next; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-74)            if (fNext != null) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-75)                fNext.prev = null; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-76)                front.next = null; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-77)            } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-78)            front = fNext; // 更新头节点 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-79)        // 队尾出队操作 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-80)        } else { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-81)            val = rear.val; // 暂存尾节点值 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-82)            // 删除尾节点 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-83)            ListNode rPrev = rear.prev; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-84)            if (rPrev != null) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-85)                rPrev.next = null; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-86)                rear.prev = null; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-87)            } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-88)            rear = rPrev; // 更新尾节点 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-89)        } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-90)        queSize--; // 更新队列长度 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-91)        return val; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-92)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-93) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-94)    /* 队首出队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-95)    public int popFirst() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-96)        return pop(true); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-97)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-98) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-99)    /* 队尾出队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-100)    public int popLast() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-101)        return pop(false); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-102)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-103) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-104)    /* 访问队首元素 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-105)    public int peekFirst() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-106)        if (isEmpty()) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-107)            throw new IndexOutOfBoundsException(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-108)        return front.val; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-109)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-110) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-111)    /* 访问队尾元素 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-112)    public int peekLast() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-113)        if (isEmpty()) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-114)            throw new IndexOutOfBoundsException(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-115)        return rear.val; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-116)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-117) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-118)    /* 返回数组用于打印 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-119)    public int[] toArray() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-120)        ListNode node = front; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-121)        int[] res = new int[size()]; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-122)        for (int i = 0; i < res.length; i++) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-123)            res[i] = node.val; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-124)            node = node.next; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-125)        } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-126)        return res; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-127)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-16-128)}`

### 2.   基于数组的实现[¶](https://www.hello-algo.com/chapter_stack_and_queue/deque/#2 "Permanent link")

如图 5-9 所示，与基于数组实现队列类似，我们也可以使用环形数组来实现双向队列。

[ArrayDeque](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_4_1)[push_last()](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_4_2)[push_first()](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_4_3)[pop_last()](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_4_4)[pop_first()](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_4_5)

[![基于数组实现双向队列的入队出队操作](https://www.hello-algo.com/chapter_stack_and_queue/deque.assets/array_deque_step1.png)](https://www.hello-algo.com/chapter_stack_and_queue/deque.assets/array_deque_step1.png)

图 5-9   基于数组实现双向队列的入队出队操作

在队列的实现基础上，仅需增加“队首入队”和“队尾出队”的方法：

[Python](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_1)[C++](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_2)[Java](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_3)[C#](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_4)[Go](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_5)[Swift](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_6)[JS](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_7)[TS](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_8)[Dart](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_9)[Rust](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_10)[C](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_11)[Kotlin](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_12)[Ruby](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_13)[Zig](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__tabbed_5_14)

array_deque.java

`[](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-1)/* 基于环形数组实现的双向队列 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-2)class ArrayDeque { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-3)    private int[] nums; // 用于存储双向队列元素的数组 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-4)    private int front; // 队首指针，指向队首元素 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-5)    private int queSize; // 双向队列长度 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-6) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-7)    /* 构造方法 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-8)    public ArrayDeque(int capacity) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-9)        this.nums = new int[capacity]; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-10)        front = queSize = 0; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-11)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-12) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-13)    /* 获取双向队列的容量 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-14)    public int capacity() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-15)        return nums.length; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-16)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-17) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-18)    /* 获取双向队列的长度 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-19)    public int size() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-20)        return queSize; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-21)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-22) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-23)    /* 判断双向队列是否为空 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-24)    public boolean isEmpty() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-25)        return queSize == 0; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-26)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-27) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-28)    /* 计算环形数组索引 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-29)    private int index(int i) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-30)        // 通过取余操作实现数组首尾相连 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-31)        // 当 i 越过数组尾部后，回到头部 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-32)        // 当 i 越过数组头部后，回到尾部 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-33)        return (i + capacity()) % capacity(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-34)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-35) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-36)    /* 队首入队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-37)    public void pushFirst(int num) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-38)        if (queSize == capacity()) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-39)            System.out.println("双向队列已满"); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-40)            return; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-41)        } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-42)        // 队首指针向左移动一位 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-43)        // 通过取余操作实现 front 越过数组头部后回到尾部 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-44)        front = index(front - 1); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-45)        // 将 num 添加至队首 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-46)        nums[front] = num; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-47)        queSize++; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-48)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-49) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-50)    /* 队尾入队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-51)    public void pushLast(int num) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-52)        if (queSize == capacity()) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-53)            System.out.println("双向队列已满"); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-54)            return; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-55)        } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-56)        // 计算队尾指针，指向队尾索引 + 1 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-57)        int rear = index(front + queSize); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-58)        // 将 num 添加至队尾 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-59)        nums[rear] = num; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-60)        queSize++; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-61)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-62) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-63)    /* 队首出队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-64)    public int popFirst() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-65)        int num = peekFirst(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-66)        // 队首指针向后移动一位 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-67)        front = index(front + 1); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-68)        queSize--; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-69)        return num; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-70)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-71) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-72)    /* 队尾出队 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-73)    public int popLast() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-74)        int num = peekLast(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-75)        queSize--; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-76)        return num; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-77)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-78) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-79)    /* 访问队首元素 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-80)    public int peekFirst() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-81)        if (isEmpty()) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-82)            throw new IndexOutOfBoundsException(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-83)        return nums[front]; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-84)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-85) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-86)    /* 访问队尾元素 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-87)    public int peekLast() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-88)        if (isEmpty()) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-89)            throw new IndexOutOfBoundsException(); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-90)        // 计算尾元素索引 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-91)        int last = index(front + queSize - 1); [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-92)        return nums[last]; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-93)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-94) [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-95)    /* 返回数组用于打印 */ [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-96)    public int[] toArray() { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-97)        // 仅转换有效长度范围内的列表元素 [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-98)        int[] res = new int[queSize]; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-99)        for (int i = 0, j = front; i < queSize; i++, j++) { [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-100)            res[i] = nums[index(j)]; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-101)        } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-102)        return res; [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-103)    } [](https://www.hello-algo.com/chapter_stack_and_queue/deque/#__codelineno-30-104)}`

## 5.3.3   双向队列应用[¶](https://www.hello-algo.com/chapter_stack_and_queue/deque/#533 "Permanent link")

双向队列兼具栈与队列的逻辑，**因此它可以实现这两者的所有应用场景，同时提供更高的自由度**。

我们知道，软件的“撤销”功能通常使用栈来实现：系统将每次更改操作 `push` 到栈中，然后通过 `pop` 实现撤销。然而，考虑到系统资源的限制，软件通常会限制撤销的步数（例如仅允许保存 50 步）。当栈的长度超过 50 时，软件需要在栈底（队首）执行删除操作。**但栈无法实现该功能，此时就需要使用双向队列来替代栈**。请注意，“撤销”的核心逻辑仍然遵循栈的先入后出原则，只是双向队列能够更加灵活地实现一些额外逻辑。